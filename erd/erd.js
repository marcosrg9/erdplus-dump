"use strict";window.erd=window.erd||{};(function(){erd.settings={};erd.settings.shapeFill="#fff";erd.settings.arrowFill="#000";erd.settings.selectedShapeFill="#aff";erd.settings.stroke="#000";erd.settings.lineWidth=1;erd.settings.font="12px Helvetica";erd.settings.smallFont="9px Helvetica";erd.settings.boldFont="Bold 12px Helvetica";erd.settings.dashArray=[5,3];erd.settings.fontColor="#000";erd.settings.selectRectFill="rgba(0,255,255,0.5)";erd.settings.connectMissStroke="#d00";erd.settings.connectHitStroke="#0c0";erd.settings.connectStrokeWidth=3;erd.settings.labelResizeShapeFill="#0c0"})();"use strict";window.erd=window.erd||{};(function(){erd.Selectable=function(){};erd.Selectable.prototype._isSelected=false;erd.Selectable.prototype.clearSelection=function(){this._isSelected=false};erd.Selectable.prototype.getIsSelected=function(){return this._isSelected};erd.Selectable.prototype.setIsSelected=function(selected){this._isSelected=selected};erd.Selectable.prototype.toggleSelected=function(){this._isSelected=!this._isSelected};erd.Selectable.prototype.postLoad=function(){}})();"use strict";window.erd=window.erd||{};(function(){erd.AttributeOwner=function(){this.childAttributes=[]};erd.AttributeOwner.prototype.addAttribute=function(attribute){if(!this.containsAttribute(attribute)){this.childAttributes.push(attribute);attribute.setOwner(this)}};erd.AttributeOwner.prototype.removeAttribute=function(attribute){this.childAttributes=_.reject(this.childAttributes,function(attr){return attr.details.id===attribute.details.id})};erd.AttributeOwner.prototype.containsAttribute=function(attribute){var found=_.find(this.childAttributes,function(attr){return attr.details.id===attribute.details.id});return found!==undefined};erd.AttributeOwner.prototype.moveChildAttributes=function(dx,dy){for(var i=0;i<this.childAttributes.length;++i){this.childAttributes[i].move(dx,dy)}};erd.AttributeOwner.prototype.removeAllChildAttributes=function(stage){for(var i=this.childAttributes.length-1;i>=0;--i){this.childAttributes[i].removeFromStage(stage)}this.childAttributes=[]};erd.AttributeOwner.prototype.getChildAttributeBounds=function(){var bounds={left:Number.MAX_VALUE,top:Number.MAX_VALUE,right:Number.MIN_VALUE,bottom:Number.MIN_VALUE};for(var i=0;i<this.childAttributes.length;++i){var other=this.childAttributes[i].getBounds(true);bounds=erd.utils.combineBounds(bounds,other)}return bounds};var autoRotations=[0,Math.PI/16,Math.PI/-16];var autoOffsets=[{x:0,y:-84},{x:72,y:-48},{x:100,y:0},{x:72,y:48},{x:0,y:84},{x:-72,y:48},{x:-100,y:0},{x:-72,y:-48},{x:0,y:-140},{x:86,y:-112},{x:165,y:-76},{x:188,y:-25},{x:188,y:25},{x:165,y:76},{x:86,y:112},{x:0,y:140},{x:-86,y:112},{x:-165,y:76},{x:-188,y:25},{x:-188,y:-25},{x:-165,y:-76},{x:-86,y:-112}];erd.AttributeOwner.prototype.getNextAutomaticPosition=function(){var center=this.getCenterPoint();for(var i=0;i<autoRotations.length;++i){var angle=autoRotations[i];for(var j=0;j<autoOffsets.length;++j){var offset=autoOffsets[j];var pt={x:center.x+offset.x,y:center.y+offset.y};pt=erd.utils.rotate(pt,center,angle);if(this.findAttributeAtPosition(pt)===null){return pt}}}return{x:center.x,y:center.y+50}};erd.AttributeOwner.prototype.findAttributeAtPosition=function(pt){for(var i=0;i<this.childAttributes.length;++i){var attr=this.childAttributes[i];if(attr.details.x===pt.x&&attr.details.y===pt.y){return attr}}return null}})();"use strict";window.erd=window.erd||{};(function(){erd.utils={};var defaultFillTextOptions={x:0,y:0,maxWidth:undefined,underline:false,dottedUnderline:false,textAlign:"left",textBaseline:"middle",font:erd.settings.font,fillStyle:erd.settings.fontColor};var defaultWrapTextOptions={x:0,y:0,width:100,height:100,font:erd.settings.font,fillStyle:erd.settings.fontColor};erd.utils.fillText=function(context,text,options){if(options===undefined){options={}}_.defaults(options,defaultFillTextOptions);context.save();context.font=options.font;context.fillStyle=options.fillStyle;context.textAlign=options.textAlign;context.textBaseline=options.textBaseline;if(typeof options.maxWidth==="number"){context.fillText(text,options.x,options.y,options.maxWidth)}else{context.fillText(text,options.x,options.y)}var textMetrics=context.measureText(text);if(options.underline){var width=Math.min(textMetrics.width,options.maxWidth);var ux,uy;if(options.textAlign==="center"){ux=options.x-width/2;uy=options.y+5.5}else if(options.textAlign==="left"){ux=options.x;uy=options.y+5.5}context.beginPath();if(options.dottedUnderline){context.setLineDash(erd.settings.dashArray)}else{context.setLineDash([])}context.lineWidth=erd.settings.strokeWidth;context.strokeStyle=erd.settings.stroke;context.moveTo(ux,uy);context.lineTo(ux+width,uy);context.stroke()}context.restore();return textMetrics};erd.utils.wrapText=function(context,text,options){if(options===undefined){options={}}_.defaults(options,defaultWrapTextOptions);context.save();context.font=options.font;context.fillStyle=options.fillStyle;context.textAlign=options.textAlign;context.textBaseline=options.textBaseline;var lineHeight=parseInt(options.font)+2;var lines=erd.utils._fragmentText(context,text,options.width);var y=options.y;if(options.textAlign==="center"&&options.textBaseline==="middle"){if(lines.length>0){var extraHeight=lineHeight*(lines.length-1);y-=extraHeight/2}}for(var i=0;i<lines.length;++i){var line=lines[i];var lineOptions={x:options.x,y:y,dottedUnderline:options.dottedUnderline,underline:options.underline,textAlign:options.textAlign,textBaseline:options.textBaseline,maxWidth:options.maxWidth};erd.utils.fillText(context,line,lineOptions);y+=lineHeight;if(options.height-y<lineHeight){break}}context.restore()};erd.utils._fragmentText=function(context,text,maxWidth){var words=text.split(" ");var lines=[];var line="";if(context.measureText(text).width<maxWidth){return[text]}while(words.length>0){while(context.measureText(words[0]).width>=maxWidth){var tmp=words[0];words[0]=tmp.slice(0,-1);if(words.length>1){words[1]=tmp.slice(-1)+words[1]}else{words.push(tmp.slice(-1))}}if(context.measureText(line+words[0]).width<maxWidth){line+=words.shift()+" "}else{lines.push(line);line=""}if(words.length===0){lines.push(line)}}return lines};erd.utils.distance=function(pt1,pt2){var dx=(pt2.x-pt1.x)*(pt2.x-pt1.x);var dy=(pt2.y-pt1.y)*(pt2.y-pt1.y);return Math.sqrt(dx+dy)};erd.utils.rectContainsPoint=function(rect,x,y){return rect.x<x&&rect.y<y&&rect.x+rect.w>x&&rect.y+rect.h>y};erd.utils.combineBounds=function(bounds1,bounds2){return{left:Math.min(bounds1.left,bounds2.left),top:Math.min(bounds1.top,bounds2.top),right:Math.max(bounds1.right,bounds2.right),bottom:Math.max(bounds1.bottom,bounds2.bottom)}};erd.utils.rotate=function(pt,origin,angle){var newX=origin.x+(pt.x-origin.x)*Math.cos(angle)-(pt.y-origin.y)*Math.sin(angle);var newY=origin.y+(pt.x-origin.x)*Math.sin(angle)+(pt.y-origin.y)*Math.cos(angle);return{x:newX,y:newY}};erd.utils.getIntersectionPoint=function(p1,p2,p3,p4){var d1=(p1.x-p2.x)*(p3.y-p4.y);var d2=(p1.y-p2.y)*(p3.x-p4.x);var d=d1-d2;if(d==0){return null}var u1=p1.x*p2.y-p1.y*p2.x;var u4=p3.x*p4.y-p3.y*p4.x;var u2x=p3.x-p4.x;var u3x=p1.x-p2.x;var u2y=p3.y-p4.y;var u3y=p1.y-p2.y;var px=(u1*u2x-u3x*u4)/d;var py=(u1*u2y-u3y*u4)/d;var p={x:px,y:py};return p}})();"use strict";window.erd=window.erd||{};(function(){var printShape;erd.debug={};erd.debug.enable=window.localStorage.getItem("debug")==="true";erd.debug._activeStage=null;erd.debug.printStage=function(){if(erd.debug._activeStage!==null){var stage=erd.debug._activeStage;for(var i=0;i<stage.shapes.length;++i){var s=stage.shapes[i];erd.debug.printShape(s)}for(var j=0;j<stage.connectors.length;++j){var c=stage.connectors[j];erd.debug.printConnector(c)}}};erd.debug.printShape=function(shape){var str=shape.getType()+" "+shape.details.name+" ("+shape.details.id+")";if(shape.getType()==="Relationship"){str=str+" slot entities "+shape.details.slots[0].entityId+", "+shape.details.slots[1].entityId}console.log(str)};erd.debug.printConnector=function(conn){var src=conn.sourceItem;var dest=conn.destinationItem;var str=conn.getType()+" ("+conn.details.id+") "+src.details.id+" -> "+dest.details.id;if(conn.getType()==="RelationshipConnector"){str=str+" slot index "+conn.details.slotIndex}console.log(str)}})();"use strict";window.erd=window.erd||{};(function(){erd.DiagramStage=function(canvasElement,options){this.factory=new erd.Factory(this);this.connect=new erd.ConnectHelper(this);this.shapes=[];this.connectors=[];this.canvas=canvasElement;this.context=this.canvas.getContext("2d");this.undoManager=new erd.UndoManager(this);this.options=options;erd.debug._activeStage=this;this.scaleX=1;this.scaleY=1;attachMouseEvent(this,"mousemove",this.onMouseMove);attachMouseEvent(this,"mousedown",this.onMouseDown);attachMouseEvent(this,"mouseup",this.onMouseUp);this.mouseHandlers={select:new erd.SelectMouseHandler(this),connect:new erd.ConnectMouseHandler(this),entity:new erd.EntityMouseHandler(this),attribute:new erd.AttributeMouseHandler(this),relationship:new erd.RelationshipMouseHandler(this),table:new erd.TableMouseHandler(this),fact:new erd.FactMouseHandler(this),dimension:new erd.DimensionMouseHandler(this),label:new erd.LabelMouseHandler(this),none:new erd.NoneMouseHandler(this)};this.resetMouseMode()};erd.DiagramStage.prototype.setScale=function(sx,sy){this.scaleX=sx;this.scaleY=sy};erd.DiagramStage.prototype.clear=function(){this.factory=new erd.Factory(this);this.shapes=[];this.connectors=[];this.undoManager.clear()};erd.DiagramStage.prototype.handleMouseDropItem=function(item){this.undoManager.startAction();this.addItem(item);this.draw();this.undoManager.endAction();this.invokeActiveItemChangedCallback(item);this.resetMouseMode()};erd.DiagramStage.prototype.invokeActiveItemChangedCallback=function(item){this.options.activeItemChangedCallback(item)};erd.DiagramStage.prototype.invokeStartMoveCallback=function(){this.options.startMoveCallback()};erd.DiagramStage.prototype.invokeEndMoveCallback=function(){this.options.endMoveCallback()};erd.DiagramStage.prototype.invokeConnectModeEndCallback=function(){this.options.connectModeEndCallback()};erd.DiagramStage.prototype.invokeDirtyCallback=function(){this.options.dirtyCallback()};erd.DiagramStage.prototype.invokeMouseModeResetCallback=function(){this.options.mouseModeResetCallback(this.mouseMode)};erd.DiagramStage.prototype.hitTest=function(x,y){for(var i=this.shapes.length-1;i>=0;i--){if(this.shapes[i].hitTest(x,y)){return this.shapes[i]}}return null};erd.DiagramStage.prototype.moveSelectedShapes=function(dx,dy){for(var i=0;i<this.shapes.length;++i){if(this.shapes[i].getIsSelected()){this.shapes[i].move(dx,dy)}}for(var j=0;j<this.shapes.length;++j){this.shapes[j].moved=false}};erd.DiagramStage.prototype.onMouseMove=function(evt,x,y){this.mouseHandlers[this.mouseMode].onMouseMove(evt,x,y)};erd.DiagramStage.prototype.onMouseDown=function(evt,x,y){this.mouseHandlers[this.mouseMode].onMouseDown(evt,x,y);this.options.selectedCountChange()};erd.DiagramStage.prototype.onMouseUp=function(evt,x,y){this.mouseHandlers[this.mouseMode].onMouseUp(evt,x,y);this.options.selectedCountChange()};erd.DiagramStage.prototype.draw=function(){var context=this.context;context.save();context.clearRect(0,0,this.canvas.width,this.canvas.height);context.scale(this.scaleX,this.scaleY);for(var j=0;j<this.connectors.length;++j){this.connectors[j].draw(context)}for(var i=0;i<this.shapes.length;++i){this.shapes[i].draw(context)}context.restore();this.mouseHandlers[this.mouseMode].drawSpecial(context)};erd.DiagramStage.prototype.clearSelection=function(){for(var i=0;i<this.shapes.length;i++){this.shapes[i].clearSelection()}};erd.DiagramStage.prototype.selectedCount=function(){var count=0;for(var i=this.shapes.length-1;i>=0;i--){var shape=this.shapes[i];if(shape.getIsSelected()){count+=1}}return count};erd.DiagramStage.prototype.selectByRect=function(rect){for(var i=0;i<this.shapes.length;++i){if(this.shapes[i].containedBy(rect)){this.shapes[i].setIsSelected(true)}}};erd.DiagramStage.prototype.deleteSelection=function(){if(this.selectedCount()>0){this.undoManager.startAction();for(var i=this.shapes.length-1;i>=0;i--){var shape=this.shapes[i];if(shape.getIsSelected()){this.shapes[i].removeFromStage(this)}}this.undoManager.endAction()}};erd.DiagramStage.prototype.selectItem=function(item){this.clearSelection();item.setIsSelected(true);this.invokeActiveItemChangedCallback(item)};erd.DiagramStage.prototype.addItem=function(item){switch(item.getType()){case"Entity":case"Attribute":case"Relationship":case"Table":case"Fact":case"Dimension":case"Label":this.shapes.push(item);break;case"Connector":case"RelationshipConnector":case"TableConnector":item.updateAnchors();this.connectors.push(item);break;default:throw"erd.DiagramStage.addItem unable to add "+item.getType()}};erd.DiagramStage.prototype.removeItem=function(item){switch(item.getType()){case"Entity":case"Attribute":case"Relationship":case"Table":case"Fact":case"Dimension":case"Label":this.shapes=_.reject(this.shapes,function(i){return i.details.id===item.details.id});break;case"Connector":case"RelationshipConnector":case"TableConnector":this.connectors=_.reject(this.connectors,function(c){return c.details.id===item.details.id});break;default:throw"erd.DiagramStage.removeItem unable to remove "+item.getType()}};erd.DiagramStage.prototype.findById=function(id){if(typeof id==="string"){id=parseInt(id)}for(var i=0;i<this.shapes.length;++i){if(this.shapes[i].details.id===id){return this.shapes[i]}}for(var j=0;j<this.connectors.length;++j){if(this.connectors[j].details.id===id){return this.connectors[j]}}return null};erd.DiagramStage.prototype.findConnectorByIds=function(id1,id2){for(var i=0;i<this.connectors.length;++i){var connector=this.connectors[i];if(connector.sourceItem.details.id===id1&&connector.destinationItem.details.id===id2||connector.sourceItem.details.id===id2&&connector.destinationItem.details.id===id1){return connector}}return null};erd.DiagramStage.prototype.findByName=function(name){for(var i=0;i<this.shapes.length;++i){if(this.shapes[i].details.name===name){return this.shapes[i]}}return null};erd.DiagramStage.prototype.findAllByType=function(type){var found=[];for(var i=0;i<this.shapes.length;++i){if(this.shapes[i].getType()===type){found.push(this.shapes[i])}}return found};erd.DiagramStage.prototype.resetMouseMode=function(){this.mouseMode="select";this.invokeMouseModeResetCallback()};erd.DiagramStage.prototype.getBounds=function(forMouseMove){var bounds={left:Number.MAX_VALUE,top:Number.MAX_VALUE,right:Number.MIN_VALUE,bottom:Number.MIN_VALUE};for(var i=0;i<this.shapes.length;++i){if(forMouseMove&&this.shapes[i].getIsSelected()){var other=this.shapes[i].getBounds(true);bounds=erd.utils.combineBounds(bounds,other)}else if(!forMouseMove){var other=this.shapes[i].getBounds(false);bounds=erd.utils.combineBounds(bounds,other)}}return bounds};var attachMouseEvent=function(diagramStage,name,callback){diagramStage.canvas.addEventListener(name,function(evt){evt.stopImmediatePropagation();var rect=diagramStage.canvas.getBoundingClientRect();var x=evt.clientX-rect.left;var y=evt.clientY-rect.top;callback.call(diagramStage,evt,x,y)})}})();"use strict";window.erd=window.erd||{};(function(){erd.SubtypeOwner=function(){this.subtypes=[]};erd.SubtypeOwner.prototype.addSubtype=function(subtype){if(!this.containsSubtype(subtype)){this.subtypes.push(subtype);subtype.setSupertype(this)}};erd.SubtypeOwner.prototype.removeSubtype=function(subtype){this.subtypes=_.reject(this.subtypes,function(sub){return sub.details.id===subtype.details.id})};erd.SubtypeOwner.prototype.containsSubtype=function(subtype){var found=_.find(this.subtypes,function(sub){return sub.details.id===subtype.details.id});return found!==undefined};erd.SubtypeOwner.prototype.moveSubtypes=function(dx,dy){this.subtypes.forEach(sub=>sub.move(dx,dy))};erd.SubtypeOwner.prototype.removeAllSubtypes=function(stage){this.subtypes.forEach(sub=>sub.removeFromStage(stage));this.subtypes=[]};erd.SubtypeOwner.prototype.getSubtypeBounds=function(){var bounds={left:Number.MAX_VALUE,top:Number.MAX_VALUE,right:Number.MIN_VALUE,bottom:Number.MIN_VALUE};for(var i=0;i<this.subtypes.length;++i){var other=this.subtypes[i].getBounds(true);bounds=erd.utils.combineBounds(bounds,other)}return bounds};const offsets=[{x:0,y:140},{x:-110,y:140},{x:110,y:140},{x:-220,y:140},{x:220,y:140}];erd.SubtypeOwner.prototype.getNextAutomaticSubtypePosition=function(){const center=this.getCenterPoint();let y=0;let i=0;let pt=undefined;do{pt={x:center.x+offsets[i].x,y:center.y+offsets[i].y+y};++i;if(i>=offsets.length){i=0;y=y+60}}while(this.isSubtypePositionAvailable(pt));return pt};erd.SubtypeOwner.prototype.isSubtypePositionAvailable=function(pt){for(let i=0;i<this.subtypes.length;++i){const details=this.subtypes[i].details;if(details.x===pt.x&&details.y===pt.y){return true}}return false}})();"use strict";window.erd=window.erd||{};(function(){var WIDTH=100;var HEIGHT=50;var HALF_WIDTH=WIDTH/2;var HALF_HEIGHT=HEIGHT/2;var WEAK_OFFSET=5;var ANCHOR_WIDTH=20;var SUPERTYPE_TAIL_SIZE=HALF_HEIGHT+40;var SUPERTYPE_RADIUS=14;var SUPERTYPE_STICK_OFFSET=2;erd.EntityType={Regular:"regular",Weak:"weak",Associative:"associative",Supertype:"super"};erd.Entity=function(details){erd.Selectable.call(this);erd.AttributeOwner.call(this);erd.SubtypeOwner.call(this);this.details={name:"Entity",type:erd.EntityType.Regular,x:0,y:0,isDisjointed:true,isTotalSpecialization:true,isSubtype:false,supertypeEntityId:null};_.assign(this.details,details);this.moved=false;this.centerAnchor=new erd.Anchor(this,0,0);this.entityAnchors=[new erd.EntityAnchor(this,-50-ANCHOR_WIDTH,.5,"left"),new erd.EntityAnchor(this,-50.5+ANCHOR_WIDTH,-25-ANCHOR_WIDTH,"top"),new erd.EntityAnchor(this,.5,-25-ANCHOR_WIDTH,"top"),new erd.EntityAnchor(this,50.5-ANCHOR_WIDTH,-25-ANCHOR_WIDTH,"top"),new erd.EntityAnchor(this,50+ANCHOR_WIDTH,.5,"right"),new erd.EntityAnchor(this,50.5-ANCHOR_WIDTH,25+ANCHOR_WIDTH,"bottom"),new erd.EntityAnchor(this,.5,25+ANCHOR_WIDTH,"bottom"),new erd.EntityAnchor(this,-50.5+ANCHOR_WIDTH,25+ANCHOR_WIDTH,"bottom")];this.supertypeAnchor=new erd.Anchor(this,0,SUPERTYPE_TAIL_SIZE);this.supertype=null};_.assign(erd.Entity.prototype,erd.Selectable.prototype);_.assign(erd.Entity.prototype,erd.AttributeOwner.prototype);_.assign(erd.Entity.prototype,erd.SubtypeOwner.prototype);erd.Entity.prototype.getSupertype=function(){return this.supertype};erd.Entity.prototype.setSupertype=function(supertype){this.supertype=supertype};erd.Entity.prototype.getType=function(){return"Entity"};erd.Entity.prototype.getCenterPoint=function(){return{x:this.details.x,y:this.details.y}};erd.Entity.prototype.getIntersectionPoint=function(otherPoint){const center=this.centerAnchor.getPoint();const bounds=this.getBounds(false);const rectangleSegments=[{from:{x:bounds.left,y:bounds.top},to:{x:bounds.left,y:bounds.bottom}},{from:{x:bounds.left,y:bounds.top},to:{x:bounds.right,y:bounds.top}},{from:{x:bounds.right,y:bounds.top},to:{x:bounds.right,y:bounds.bottom}},{from:{x:bounds.left,y:bounds.bottom},to:{x:bounds.right,y:bounds.bottom}}];for(let i=0;i<rectangleSegments.length;++i){const intersection=isect.brute([{from:otherPoint,to:center},rectangleSegments[i]]).run();if(intersection.length>0){return intersection[0].point}}return null};erd.Entity.prototype.hitTest=function(x,y){return this.details.x-HALF_WIDTH<x&&this.details.y-HALF_HEIGHT<y&&this.details.x+HALF_WIDTH>x&&this.details.y+HALF_HEIGHT>y};erd.Entity.prototype.containedBy=function(rect){return erd.utils.rectContainsPoint(rect,this.details.x,this.details.y)};erd.Entity.prototype.move=function(dx,dy){if(!this.moved){this.moved=true;this.details.x+=dx;this.details.y+=dy;this.moveChildAttributes(dx,dy);this.moveSubtypes(dx,dy);this.updateConnectors()}};erd.Entity.prototype.drawAsConnectTarget=function(context,strokeStyle){this.draw(context);context.save();context.beginPath();context.translate(this.details.x,this.details.y);context.rect(-HALF_WIDTH,-HALF_HEIGHT,WIDTH,HEIGHT);context.strokeStyle=strokeStyle;context.lineWidth=erd.settings.connectStrokeWidth*2;context.stroke();context.restore()};erd.Entity.prototype.draw=function(context){context.save();context.translate(this.details.x+.5,this.details.y+.5);context.beginPath();if(this.getIsSelected()){context.fillStyle=erd.settings.selectedShapeFill}else{context.fillStyle=erd.settings.shapeFill}context.rect(-HALF_WIDTH,-HALF_HEIGHT,WIDTH,HEIGHT);context.lineWidth=erd.settings.strokeWidth;context.strokeStyle=erd.settings.stroke;context.closePath();context.fill();context.stroke();if(this.details.type===erd.EntityType.Weak){context.beginPath();context.rect(-HALF_WIDTH+WEAK_OFFSET,-HALF_HEIGHT+WEAK_OFFSET,WIDTH-WEAK_OFFSET*2,HEIGHT-WEAK_OFFSET*2);context.stroke()}else if(this.details.type===erd.EntityType.Associative){context.beginPath();context.moveTo(0,-HALF_HEIGHT);context.lineTo(HALF_WIDTH,0);context.lineTo(0,HALF_HEIGHT);context.lineTo(-HALF_WIDTH,0);context.closePath();context.stroke()}var text=this.details.name;if(erd.debug.enable){text=text+" "+this.details.id}erd.utils.wrapText(context,text,{textAlign:"center",textBaseline:"middle",maxWidth:WIDTH});if(this.details.type===erd.EntityType.Supertype){if(this.details.isTotalSpecialization){context.beginPath();context.moveTo(SUPERTYPE_STICK_OFFSET,HALF_HEIGHT);context.lineTo(SUPERTYPE_STICK_OFFSET,SUPERTYPE_TAIL_SIZE);context.closePath();context.stroke();context.beginPath();context.moveTo(-SUPERTYPE_STICK_OFFSET,HALF_HEIGHT);context.lineTo(-SUPERTYPE_STICK_OFFSET,SUPERTYPE_TAIL_SIZE);context.closePath();context.stroke()}else{context.beginPath();context.moveTo(0,HALF_HEIGHT);context.lineTo(0,SUPERTYPE_TAIL_SIZE);context.closePath();context.stroke()}context.beginPath();context.moveTo(SUPERTYPE_RADIUS,SUPERTYPE_TAIL_SIZE);context.arc(0,SUPERTYPE_TAIL_SIZE,SUPERTYPE_RADIUS,0,2*Math.PI,false);context.fill();context.closePath();context.stroke();const label=this.details.isDisjointed?"d":"o";context.translate(0,SUPERTYPE_TAIL_SIZE);erd.utils.wrapText(context,label,{textAlign:"center",textBaseline:"middle",maxWidth:SUPERTYPE_RADIUS})}context.restore();for(var i=0;i<this.entityAnchors.length;++i){this.entityAnchors[i].draw(context)}};erd.Entity.prototype.updateConnectors=function(){for(var i=0;i<this.entityAnchors.length;++i){var anchor=this.entityAnchors[i];anchor.updateAllConnectors()}};erd.Entity.prototype.removeFromStage=function(stage){this.centerAnchor.removeAllConnectorsFromStage(stage);this.supertypeAnchor.removeAllConnectorsFromStage(stage);for(var i=0;i<this.entityAnchors.length;++i){this.entityAnchors[i].removeAllConnectorsFromStage(stage)}if(this.details.isSubtype){const supertype=stage.findById(this.details.supertypeEntityId);supertype.removeSubtype(this)}stage.removeItem(this)};erd.Entity.prototype.getBounds=function(forMouseMove){var bounds={left:this.details.x-HALF_WIDTH,top:this.details.y-HALF_HEIGHT,right:this.details.x+HALF_WIDTH+1,bottom:this.details.y+HALF_HEIGHT+1};if(forMouseMove){var other=this.getChildAttributeBounds();bounds=erd.utils.combineBounds(bounds,other)}return bounds}})();"use strict";window.erd=window.erd||{};(function(){var WIDTH=100;var HEIGHT=50;var HALF_WIDTH=WIDTH/2;var HALF_HEIGHT=HEIGHT/2;erd.Attribute=function(details){erd.Selectable.call(this);erd.AttributeOwner.call(this);this.details={name:"Attribute",isDerived:false,isMultivalued:false,isOptional:false,isComposite:false,isUnique:false,x:0,y:0};_.assign(this.details,details);this.centerAnchor=new erd.Anchor(this,0,0);this.owner=null};_.assign(erd.Attribute.prototype,erd.Selectable.prototype);_.assign(erd.Attribute.prototype,erd.AttributeOwner.prototype);erd.Attribute.prototype.getType=function(){return"Attribute"};erd.Attribute.prototype.isPartiallyUnique=function(){return this.owner!==null&&this.owner.getType()==="Entity"&&this.owner.details.type==="weak"};erd.Attribute.prototype.getCenterPoint=function(){return{x:this.details.x,y:this.details.y}};erd.Attribute.prototype.hitTest=function(x,y){var dx=x-this.details.x;var dy=y-this.details.y;return dx*dx/(HALF_WIDTH*HALF_WIDTH)+dy*dy/(HALF_HEIGHT*HALF_HEIGHT)<=1};erd.Attribute.prototype.containedBy=function(rect){return erd.utils.rectContainsPoint(rect,this.details.x,this.details.y)};erd.Attribute.prototype.move=function(dx,dy){if(!this.moved){this.moved=true;this.details.x+=dx;this.details.y+=dy;this.moveChildAttributes(dx,dy)}};erd.Attribute.prototype.getOwner=function(){return this.owner};erd.Attribute.prototype.setOwner=function(owner){this.owner=owner};erd.Attribute.prototype.removeFromStage=function(stage){this.centerAnchor.removeAllConnectorsFromStage(stage);if(this.owner!==null){this.owner.removeAttribute(this)}stage.removeItem(this)};erd.Attribute.prototype.drawAsConnectTarget=function(context,strokeStyle){this.draw(context);context.save();context.beginPath();context.translate(this.details.x,this.details.y);context.scale(1,.5);context.strokeStyle=strokeStyle;context.lineWidth=erd.settings.connectStrokeWidth*2;context.arc(0,0,HALF_WIDTH,0,Math.PI*2,false);context.stroke();context.restore()};erd.Attribute.prototype.draw=function(context){context.save();context.translate(this.details.x,this.details.y);context.save();context.beginPath();context.scale(1,.5);if(this.details.isDerived){context.setLineDash(erd.settings.dashArray)}else{context.setLineDash([])}if(this.getIsSelected()){context.fillStyle=erd.settings.selectedShapeFill}else{context.fillStyle=erd.settings.shapeFill}context.arc(0,0,HALF_WIDTH,0,Math.PI*2,false);context.lineWidth=erd.settings.strokeWidth;context.strokeStyle=erd.settings.stroke;context.fill();context.stroke();if(this.details.isMultivalued){context.beginPath();context.scale(1,.92);context.arc(0,0,HALF_WIDTH-3,0,Math.PI*2,false);context.stroke()}context.restore();var text=this.details.name;if(this.details.isOptional){text=text+" (O)"}else if(this.details.isComposite){text="( "+text+" )"}erd.utils.wrapText(context,text,{textAlign:"center",textBaseline:"middle",underline:this.details.isUnique,dottedUnderline:this.isPartiallyUnique(),maxWidth:WIDTH});context.restore()};erd.Attribute.prototype.getBounds=function(forMouseMove){var bounds={left:this.details.x-HALF_WIDTH,top:this.details.y-HALF_HEIGHT,right:this.details.x+HALF_WIDTH+1,bottom:this.details.y+HALF_HEIGHT+1};if(forMouseMove){var other=this.getChildAttributeBounds();bounds=erd.utils.combineBounds(bounds,other)}return bounds}})();"use strict";window.erd=window.erd||{};(function(){var WIDTH=100;var HEIGHT=50;var HALF_WIDTH=WIDTH/2;var HALF_HEIGHT=HEIGHT/2;var IDENTIFYING_OFFSET_X=8;var IDENTIFYING_OFFSET_Y=5;erd.Relationship=function(details){erd.Selectable.call(this);erd.AttributeOwner.call(this);this.details={name:"Relationship",isIdentifying:false,x:0,y:0,slots:[{slotIndex:0,minimum:"",maximum:"",participation:erd.ParticipationType.unspecified,cardinality:erd.CardinalityType.unspecified,role:"",entityId:0},{slotIndex:1,minimum:"",maximum:"",participation:erd.ParticipationType.unspecified,cardinality:erd.CardinalityType.unspecified,role:"",entityId:0}]};_.assign(this.details,details);this.centerAnchor=new erd.Anchor(this,0,0);this.outerAnchors=[new erd.RelationshipAnchor(this,-HALF_WIDTH,0,"left"),new erd.RelationshipAnchor(this,0,-HALF_HEIGHT,"top"),new erd.RelationshipAnchor(this,HALF_WIDTH,0,"right"),new erd.RelationshipAnchor(this,0,HALF_HEIGHT,"bottom")]};_.assign(erd.Relationship.prototype,erd.Selectable.prototype);_.assign(erd.Relationship.prototype,erd.AttributeOwner.prototype);erd.Relationship.prototype.getType=function(){return"Relationship"};erd.Relationship.prototype.getCenterPoint=function(){return{x:this.details.x,y:this.details.y}};erd.Relationship.prototype.getOppositeAnchor=function(anchor){switch(anchor.side){case"left":return this.outerAnchors[2];case"top":return this.outerAnchors[3];case"right":return this.outerAnchors[0];case"bottom":return this.outerAnchors[1]}};erd.Relationship.prototype.hitTest=function(x,y){return this.details.x-HALF_WIDTH<x&&this.details.y-HALF_HEIGHT<y&&this.details.x+HALF_WIDTH>x&&this.details.y+HALF_HEIGHT>y};erd.Relationship.prototype.containedBy=function(rect){return erd.utils.rectContainsPoint(rect,this.details.x,this.details.y)};erd.Relationship.prototype.move=function(dx,dy){if(!this.moved){this.moved=true;this.details.x+=dx;this.details.y+=dy;this.moveChildAttributes(dx,dy);this.updateConnectors()}};erd.Relationship.prototype.drawAsConnectTarget=function(context,strokeStyle){this.draw(context);context.save();context.beginPath();context.translate(this.details.x,this.details.y);context.strokeStyle=strokeStyle;context.lineWidth=erd.settings.connectStrokeWidth*2;context.moveTo(0,-HALF_HEIGHT);context.lineTo(HALF_WIDTH,0);context.lineTo(0,HALF_HEIGHT);context.lineTo(-HALF_WIDTH,0);context.closePath();context.stroke();context.restore()};erd.Relationship.prototype.draw=function(context){context.save();context.translate(this.details.x+.5,this.details.y+.5);context.lineWidth=erd.settings.strokeWidth;context.strokeStyle=erd.settings.stroke;if(this.getIsSelected()){context.fillStyle=erd.settings.selectedShapeFill}else{context.fillStyle=erd.settings.shapeFill}context.beginPath();context.moveTo(0,-HALF_HEIGHT);context.lineTo(HALF_WIDTH,0);context.lineTo(0,HALF_HEIGHT);context.lineTo(-HALF_WIDTH,0);context.closePath();context.fill();context.stroke();if(this.details.isIdentifying){context.beginPath();context.moveTo(0,-HALF_HEIGHT+IDENTIFYING_OFFSET_Y);context.lineTo(HALF_WIDTH-IDENTIFYING_OFFSET_X,0);context.lineTo(0,HALF_HEIGHT-IDENTIFYING_OFFSET_Y);context.lineTo(-HALF_WIDTH+IDENTIFYING_OFFSET_X,0);context.closePath();context.stroke()}var text=this.details.name;if(erd.debug.enable){text+=" "+this.details.id}erd.utils.wrapText(context,this.details.name,{textAlign:"center",textBaseline:"middle",maxWidth:WIDTH});context.restore()};erd.Relationship.prototype.updateConnectors=function(){for(var i=0;i<this.outerAnchors.length;++i){var anchor=this.outerAnchors[i];anchor.updateAllConnectors()}};erd.Relationship.prototype.getSlot=function(slot){if(typeof slot==="number"&&slot>=0&&slot<this.details.slots.length){return this.details.slots[slot]}return null};erd.Relationship.prototype.getAvailableSlot=function(){for(var i=0;i<this.details.slots.length;++i){if(this.details.slots[i].entityId===0){return this.details.slots[i]}}return null};erd.Relationship.prototype.getSlotConnector=function(slot){var entityId=this.details.slots[slot].entityId;for(var i=0;i<this.outerAnchors.length;++i){var anchor=this.outerAnchors[i];for(var j=0;j<anchor.connectors.length;++j){if(anchor.connectors[j].entity.details.id===entityId&&anchor.connectors[j].details.slotIndex===slot){return anchor.connectors[j]}}}return null};erd.Relationship.prototype.removeFromStage=function(stage){this.centerAnchor.removeAllConnectorsFromStage(stage);for(var i=0;i<this.outerAnchors.length;++i){this.outerAnchors[i].removeAllConnectorsFromStage(stage)}stage.removeItem(this)};erd.Relationship.prototype.relatedEntityCount=function(){var count=0;for(var i=0;i<this.details.slots.length;++i){if(this.details.slots[i].entityId!==0){count+=1}}return count};erd.Relationship.prototype.getBounds=function(forMouseMove){var bounds={left:this.details.x-HALF_WIDTH,top:this.details.y-HALF_HEIGHT,right:this.details.x+HALF_WIDTH+1,bottom:this.details.y+HALF_HEIGHT+1};if(forMouseMove){var other=this.getChildAttributeBounds();bounds=erd.utils.combineBounds(bounds,other)}return bounds}})();"use strict";window.erd=window.erd||{};(function(){erd.Factory=function(stage){this.stage=stage;this.nextId=1};erd.Factory.prototype.entity=function(details){return this.initItem(new erd.Entity(details))};erd.Factory.prototype.attribute=function(details){return this.initItem(new erd.Attribute(details))};erd.Factory.prototype.relationship=function(details){return this.initItem(new erd.Relationship(details))};erd.Factory.prototype.table=function(details){return this.initItem(new erd.Table(details))};erd.Factory.prototype.fact=function(details){return this.initItem(new erd.Fact(details))};erd.Factory.prototype.dimension=function(details){return this.initItem(new erd.Dimension(details))};erd.Factory.prototype.label=function(details){return this.initItem(new erd.Label(details))};erd.Factory.prototype.initItem=function(item){if(typeof item.details.id==="number"){if(this.nextId<=item.details.id){this.nextId=item.details.id+1}}else{item.details.id=this.nextId;this.nextId+=1}return item};erd.Factory.prototype.createConnector=function(sourceItem,destinationItem,details){return this.initItem(new erd.Connector(sourceItem,destinationItem,details))};erd.Factory.prototype.createRelationshipConnector=function(sourceItem,destinationItem,details){return this.initItem(new erd.RelationshipConnector(sourceItem,destinationItem,details))};erd.Factory.prototype.createTableConnector=function(pkTable,fkTable,details){return this.initItem(new erd.TableConnector(pkTable,fkTable,details))}})();"use strict";window.erd=window.erd||{};(function(){erd.Anchor=function(owner,dx,dy){this.owner=owner;this.dx=dx;this.dy=dy;this.connectors=[]};erd.Anchor.prototype.setOffsetX=function(dx){this.dx=dx};erd.Anchor.prototype.setOffsetY=function(dy){this.dy=dy};erd.Anchor.prototype.getPoint=function(){var pt=this.owner.getCenterPoint();return{x:pt.x+this.dx,y:pt.y+this.dy}};erd.Anchor.prototype.addConnector=function(connector){this.connectors.push(connector)};erd.Anchor.prototype.removeConnector=function(connector){this.connectors=_.reject(this.connectors,function(conn){return conn.details.id===connector.details.id})};erd.Anchor.prototype.firstConnector=function(){if(this.connectors.length>0){return this.connectors[0]}return null};erd.Anchor.prototype.countConnectors=function(){return this.connectors.length};erd.Anchor.prototype.updateAllConnectors=function(){for(var i=0;i<this.connectors.length;++i){this.connectors[i].updateAnchors()}};erd.Anchor.prototype.removeAllConnectorsFromStage=function(stage){for(var i=this.connectors.length-1;i>=0;--i){var connector=this.connectors[i];connector.removeFromStage(stage)}}})();"use strict";window.erd=window.erd||{};(function(){var WIDTH=20;erd.EntityAnchor=function(owner,dx,dy,side){erd.Anchor.call(this,owner,dx,dy);this.side=side};_.assign(erd.EntityAnchor.prototype,erd.Anchor.prototype);erd.EntityAnchor.prototype.draw=function(context){if(this.firstConnector()!==null){context.save();var pt=this.getPoint();context.translate(pt.x,pt.y);context.fillStyle=erd.settings.shapeFill;context.strokeStyle=erd.settings.stroke;context.save();switch(this.side){case"right":context.rotate(Math.PI/2);break;case"bottom":context.rotate(Math.PI);break;case"left":context.rotate(Math.PI/-2);break}context.beginPath();context.moveTo(0,0);context.lineTo(0,WIDTH);context.stroke();var slotDetails=this.firstConnector().getOppositeRelationshipSlot();if(slotDetails!==null){this.drawCardinality(context,slotDetails.cardinality);this.drawParticipation(context,slotDetails.participation);context.restore();this.drawExactConstraints(context,slotDetails.minimum,slotDetails.maximum);context.restore();this.drawRole(context,slotDetails.role)}else{context.restore();context.restore()}}};erd.EntityAnchor.prototype.drawExactConstraints=function(context,min,max){if(min.length>0||max.length>0){if(min.length===0){min="1"}if(max.length===0){max="M"}var text="("+min+","+max+")";switch(this.side){case"top":case"bottom":erd.utils.fillText(context,text,{x:-WIDTH/2,textAlign:"right"});break;case"right":erd.utils.fillText(context,text,{y:WIDTH/2,textAlign:"left"});break;case"left":erd.utils.fillText(context,text,{y:-WIDTH/2,textAlign:"right"});break}}};erd.EntityAnchor.prototype.drawRole=function(context,role){if(typeof role==="string"){context.save();var pt1=this.getPoint();var pt2=this.firstConnector().destinationAnchor.getPoint();var x=(pt1.x+pt2.x)/2;var y=(pt1.y+pt2.y)/2;context.translate(x,y);erd.utils.fillText(context,role,{textAlign:"center"});context.restore()}};erd.EntityAnchor.prototype.drawParticipation=function(context,participation){if(participation===erd.ParticipationType.mandatory){context.beginPath();context.moveTo(-8,WIDTH/2-2.5);context.lineTo(8,WIDTH/2-2.5);context.stroke()}else if(participation===erd.ParticipationType.optional){context.beginPath();context.scale(1,.4);context.arc(0,15,8,0,2*Math.PI,false);context.fill();context.stroke()}};erd.EntityAnchor.prototype.drawCardinality=function(context,cardinality){if(cardinality===erd.CardinalityType.many){context.moveTo(0,WIDTH-9);context.lineTo(-9,WIDTH);context.moveTo(0,WIDTH-9);context.lineTo(9,WIDTH);context.stroke()}else if(cardinality===erd.CardinalityType.one){context.beginPath();context.moveTo(-8,WIDTH/2+4.5);context.lineTo(8,WIDTH/2+4.5);context.stroke()}}})();"use strict";window.erd=window.erd||{};(function(){var WIDTH=20;erd.RelationshipAnchor=function(owner,dx,dy,side){erd.Anchor.call(this,owner,dx,dy);this.side=side};_.assign(erd.RelationshipAnchor.prototype,erd.Anchor.prototype)})();"use strict";window.erd=window.erd||{};(function(){erd.Connector=function(sourceItem,destinationItem,details){this.sourceItem=sourceItem;this.destinationItem=destinationItem;this.sourceAnchor=null;this.destinationAnchor=null;this.details={};_.assign(this.details,details)};erd.Connector.prototype.draw=function(context){if(this.sourceAnchor!==null&&this.destinationAnchor!==null){var pt1=this.sourceAnchor.getPoint();var pt2=this.destinationAnchor.getPoint();context.beginPath();context.moveTo(pt1.x,pt1.y);context.lineTo(pt2.x,pt2.y);context.stroke();if(this.details.isSupertypeConnector){const intersection=this.sourceItem.getIntersectionPoint(pt2);if(intersection){const mid={x:(intersection.x+pt2.x)/2,y:(intersection.y+pt2.y)/2};context.save();context.translate(mid.x,mid.y);context.beginPath();context.rotate(Math.atan2(pt1.y-pt2.y,pt1.x-pt2.x));context.rotate(-Math.PI/2);context.scale(.7,1);context.arc(0,0,10,0,Math.PI,false);context.stroke();context.restore()}}if(erd.debug.enable){erd.utils.fillText(context,this.details.id,{x:(pt1.x+pt2.x)/2,y:(pt1.y+pt2.y)/2})}}};erd.Connector.prototype.getType=function(){return"Connector"};erd.Connector.prototype.updateAnchors=function(){if(this.sourceAnchor===null||this.destinationAnchor===null){this.sourceAnchor=this.sourceItem.centerAnchor;this.sourceAnchor.addConnector(this);if(this.details.isSupertypeConnector){this.destinationAnchor=this.destinationItem.supertypeAnchor}else{this.destinationAnchor=this.destinationItem.centerAnchor}this.destinationAnchor.addConnector(this)}};erd.Connector.prototype.removeFromStage=function(stage){if(this.sourceAnchor!==null){this.sourceAnchor.removeConnector(this);this.sourceAnchor=null;this.sourceItem=null}if(this.destinationAnchor!==null){this.destinationAnchor.removeConnector(this);this.destinationAnchor=null;this.destinationItem=null}stage.removeItem(this)}})();"use strict";window.erd=window.erd||{};(function(){erd.ParticipationType={mandatory:"mandatory",optional:"optional",unspecified:"unspecified"};erd.CardinalityType={many:"many",one:"one",unspecified:"unspecified"};erd.RelationshipConnector=function(entity,relationship,details){erd.Connector.call(this,entity,relationship,details);this.entity=entity;this.relationship=relationship};_.assign(erd.RelationshipConnector.prototype,erd.Connector.prototype);erd.RelationshipConnector.prototype.getType=function(){return"RelationshipConnector"};erd.RelationshipConnector.prototype.removeFromStage=function(stage){var slot=this.getRelationshipSlot();if(slot!==null){slot.entityId=0}erd.Connector.prototype.removeFromStage.call(this,stage)};erd.RelationshipConnector.prototype.getRelationshipSlot=function(){return this.relationship.getSlot(this.details.slotIndex)};erd.RelationshipConnector.prototype.getOppositeRelationshipSlot=function(){var index=(this.details.slotIndex+1)%2;var details=this.relationship.getSlot(index);if(details.entityId!==0){return details}else{return null}};erd.RelationshipConnector.prototype.updateAnchors=function(){if(this.sourceAnchor!==null){this.sourceAnchor.removeConnector(this);this.sourceAnchor=null}if(this.destinationAnchor!==null){this.destinationAnchor.removeConnector(this);this.destinationAnchor=null}var otherConnector=this.getOtherConnector();if(otherConnector===null){this.updateAnchorsSingleConnector()}else if(this.isUnary()){this.updateAnchorsUnaryConnector(otherConnector)}else{this.updateAnchorsDoubleConnector(otherConnector)}};erd.RelationshipConnector.prototype.updateAnchorsSingleConnector=function(){var distances=this.computeDistances();var closestPair=this.getClosestPair(distances);this.sourceAnchor=closestPair.eAnchor;this.destinationAnchor=closestPair.rAnchor;this.sourceAnchor.addConnector(this);this.destinationAnchor.addConnector(this)};erd.RelationshipConnector.prototype.updateAnchorsDoubleConnector_old=function(otherConnector){var thisDistances=this.computeDistances();var thisClosestPair=this.getClosestPair(thisDistances);var otherDistances=otherConnector.computeDistances();otherConnector.replaceAnchors(null,null);var otherClosestPair=this.getClosestPair(otherDistances);if(thisClosestPair.distance<otherClosestPair.distance){this.sourceAnchor=thisClosestPair.eAnchor;this.destinationAnchor=thisClosestPair.rAnchor;var oppositeAnchor=this.relationship.getOppositeAnchor(thisClosestPair.rAnchor);var eAnchor=this.getClosestPairByAnchor(otherDistances,oppositeAnchor).eAnchor;otherConnector.replaceAnchors(eAnchor,oppositeAnchor)}else{otherConnector.replaceAnchors(otherClosestPair.eAnchor,otherClosestPair.rAnchor);var oppositeAnchor=this.relationship.getOppositeAnchor(otherClosestPair.rAnchor);var eAnchor=this.getClosestPairByAnchor(thisDistances,oppositeAnchor).eAnchor;this.sourceAnchor=eAnchor;this.destinationAnchor=oppositeAnchor}this.sourceAnchor.addConnector(this);this.destinationAnchor.addConnector(this)};erd.RelationshipConnector.prototype.updateAnchorsDoubleConnector=function(otherConnector){var thisDistances=this.computeDistances();var otherDistances=otherConnector.computeDistances();otherConnector.replaceAnchors(null,null);var minDistance=Number.MAX_VALUE;var bestConfig=null;for(var i=0;i<this.relationship.outerAnchors.length;++i){var config={};config.rAnchor1=this.relationship.outerAnchors[i];var pair=this.getClosestPairByAnchor(thisDistances,config.rAnchor1);config.eAnchor1=pair.eAnchor;config.distance=pair.distance;config.rAnchor2=this.relationship.getOppositeAnchor(config.rAnchor1);pair=this.getClosestPairByAnchor(otherDistances,config.rAnchor2);config.eAnchor2=pair.eAnchor;config.distance+=pair.distance;if(config.distance<minDistance){bestConfig=config;minDistance=config.distance}}this.sourceAnchor=bestConfig.eAnchor1;this.destinationAnchor=bestConfig.rAnchor1;this.sourceAnchor.addConnector(this);this.destinationAnchor.addConnector(this);otherConnector.replaceAnchors(bestConfig.eAnchor2,bestConfig.rAnchor2)};erd.RelationshipConnector.prototype.updateAnchorsUnaryConnector=function(){var thisDistances=this.computeDistances();var arr=[];for(var i=0;i<thisDistances.length;++i){if(thisDistances[i].eAnchor.side==="top"||thisDistances[i].eAnchor.side==="bottom"){arr.push(thisDistances[i])}}thisDistances=arr;var otherConnector=this.getOtherConnector();var pt1=this.relationship.getCenterPoint();var pt2=this.entity.getCenterPoint();var thisRelationshipAnchor;var otherRelationshipAnchor;if(Math.abs(pt1.x-pt2.x)<Math.abs(pt1.y-pt2.y)){if(this.details.id<otherConnector.details.id){thisRelationshipAnchor=this.relationship.outerAnchors[0];otherRelationshipAnchor=this.relationship.outerAnchors[2]}else{thisRelationshipAnchor=this.relationship.outerAnchors[2];otherRelationshipAnchor=this.relationship.outerAnchors[0]}}else{if(this.details.id<otherConnector.details.id){thisRelationshipAnchor=this.relationship.outerAnchors[1];otherRelationshipAnchor=this.relationship.outerAnchors[3]}else{thisRelationshipAnchor=this.relationship.outerAnchors[3];otherRelationshipAnchor=this.relationship.outerAnchors[1]}}otherConnector.replaceAnchors(null,null);this.sourceAnchor=this.getClosestPairByAnchor(thisDistances,thisRelationshipAnchor).eAnchor;this.destinationAnchor=thisRelationshipAnchor;this.sourceAnchor.addConnector(this);this.destinationAnchor.addConnector(this);var otherEntityAnchor=this.getClosestPairByAnchor(thisDistances,otherRelationshipAnchor).eAnchor;otherConnector.replaceAnchors(otherEntityAnchor,otherRelationshipAnchor)};erd.RelationshipConnector.prototype.replaceAnchors=function(eAnchor,rAnchor){if(this.sourceAnchor!==null){this.sourceAnchor.removeConnector(this);this.sourceAnchor=null}if(this.destinationAnchor!==null){this.destinationAnchor.removeConnector(this);this.destinationAnchor=null}if(eAnchor!==null){this.sourceAnchor=eAnchor;this.sourceAnchor.addConnector(this)}if(rAnchor!==null){this.destinationAnchor=rAnchor;this.destinationAnchor.addConnector(this)}};erd.RelationshipConnector.prototype.getOtherConnector=function(){var otherConnector=null;for(var i=0;i<this.relationship.outerAnchors.length;++i){var anchor=this.relationship.outerAnchors[i];if(anchor.firstConnector()!==null&&anchor.firstConnector().details.id!==this.details.id){otherConnector=anchor.firstConnector()}}return otherConnector};erd.RelationshipConnector.prototype.isUnary=function(){return this.relationship.details.slots[0].entityId===this.relationship.details.slots[1].entityId};erd.RelationshipConnector.prototype.computeDistances=function(){var distances=[];for(var i=0;i<this.relationship.outerAnchors.length;++i){for(var j=0;j<this.entity.entityAnchors.length;++j){var pair={rAnchor:this.relationship.outerAnchors[i],eAnchor:this.entity.entityAnchors[j]};pair.distance=erd.utils.distance(pair.rAnchor.getPoint(),pair.eAnchor.getPoint());distances.push(pair)}}return distances};erd.RelationshipConnector.prototype.getClosestPair=function(distances){var index=0;for(var i=1;i<distances.length;++i){if(distances[i].distance<distances[index].distance&&distances[i].eAnchor.countConnectors()===0){index=i}}return distances[index]};erd.RelationshipConnector.prototype.getClosestPairByAnchor=function(distances,relationshipAnchor){var d=Number.MAX_VALUE;var index=-1;for(var i=0;i<distances.length;++i){if(relationshipAnchor===distances[i].rAnchor){if(distances[i].distance<d&&distances[i].eAnchor.countConnectors()===0){d=distances[i].distance;index=i}}}return distances[index]}})();"use strict";window.erd=window.erd||{};(function(){erd.ConnectHelper=function(stage){this.stage=stage};erd.ConnectHelper.prototype.items=function(source,destination,details){if(typeof details!=="object"){details={}}if(source&&destination){var s=source.getType();var d=destination.getType();if(s==="Attribute"&&d==="Entity"){return this.attributeToEntity(source,destination)}else if(s==="Entity"&&d==="Attribute"){return this.attributeToEntity(destination,source)}else if(s==="Attribute"&&d==="Attribute"){if(source.details.isComposite){return this.attributeToAttribute(destination,source)}else if(destination.details.isComposite){return this.attributeToAttribute(source,destination)}}else if(s==="Entity"&&d==="Relationship"){return this.entityToRelationship(source,destination,details)}else if(s==="Relationship"&&d==="Entity"){return this.entityToRelationship(destination,source,details)}else if(s==="Attribute"&&d==="Relationship"){return this.attributeToRelationship(source,destination)}else if(s==="Relationship"&&d==="Attribute"){return this.attributeToRelationship(destination,source)}else if(s==="Table"&&d==="Table"){if(source.hasPk()){return this.tableToTable(source,destination,details)}else if(destination.hasPk()){return this.tableToTable(destination,source,details)}}else if(s==="Dimension"&&d==="Dimension"){if(source.hasPk()){return this.tableToTable(source,destination,details)}else if(destination.hasPk()){return this.tableToTable(destination,source,details)}}else if(s==="Dimension"&&d==="Fact"){if(source.hasPk()){return this.tableToTable(source,destination,details)}}else if(s==="Entity"&&d==="Entity"){if(source.details.isSubtype===true&&source.details.supertypeEntityId===destination.details.id&&destination.details.type===erd.EntityType.Supertype){return this.subtypeToSupertype(source,destination,details)}}}};erd.ConnectHelper.prototype.subtypeToSupertype=function(subType,superType,details){const connector=this.stage.factory.createConnector(subType,superType,details);superType.addSubtype(subType);this.stage.addItem(connector)};erd.ConnectHelper.prototype.attributeToEntity=function(attribute,entity){this.disconnectAttribute(attribute);var connector=this.stage.factory.createConnector(attribute,entity);entity.addAttribute(attribute);this.stage.addItem(connector)};erd.ConnectHelper.prototype.attributeToRelationship=function(attribute,relationship){this.disconnectAttribute(attribute);var connector=this.stage.factory.createConnector(attribute,relationship);relationship.addAttribute(attribute);this.stage.addItem(connector)};erd.ConnectHelper.prototype.attributeToAttribute=function(attribute,compositeAttribute){this.disconnectAttribute(attribute);var connector=this.stage.factory.createConnector(attribute,compositeAttribute);compositeAttribute.addAttribute(attribute);this.stage.addItem(connector)};erd.ConnectHelper.prototype.entityToRelationship=function(entity,relationship,details){var slot=relationship.getSlot(details.slotIndex);if(slot===null){slot=relationship.getAvailableSlot();details.slotIndex=slot.slotIndex}slot.entityId=entity.details.id;var connector=this.stage.factory.createRelationshipConnector(entity,relationship,details);this.stage.addItem(connector);relationship.updateConnectors()};erd.ConnectHelper.prototype.tableToTable=function(pkTable,fkTable,details){if(typeof details.fkAttributeId==="number"&&fkTable.getAttributeById(details.fkAttributeId)!==null){var connector=this.stage.factory.createTableConnector(pkTable,fkTable,details);this.stage.addItem(connector)}else{var fk=pkTable.createFk(pkTable);fkTable.addAttribute(fk);var connector=this.stage.factory.createTableConnector(pkTable,fkTable,{fkAttributeId:fk.id});this.stage.addItem(connector);return fk}};erd.ConnectHelper.prototype.disconnectAttribute=function(attribute){if(attribute.getOwner()!==null){var connector=this.stage.findConnectorByIds(attribute.details.id,attribute.getOwner().details.id);if(connector!==null){this.stage.removeItem(connector)}attribute.getOwner().removeAttribute(attribute);attribute.setOwner(null)}}})();"use strict";window.erd=window.erd||{};(function(){var VERSION=2;erd.DiagramArchive=function(stage){this.stage=stage};erd.DiagramArchive.prototype.toJson=function(){var data={version:VERSION,www:"erdplus.com",shapes:[],connectors:[],width:this.stage.canvas.width,height:this.stage.canvas.height};this.storeShapes(data);this.storeConnectors(data);return JSON.stringify(data)};erd.DiagramArchive.prototype.storeShapes=function(data){for(var i=0;i<this.stage.shapes.length;++i){var shape=this.stage.shapes[i];var info={type:shape.getType(),details:_.clone(shape.details)};data.shapes.push(info)}};erd.DiagramArchive.prototype.storeConnectors=function(data){for(var i=0;i<this.stage.connectors.length;++i){var connector=this.stage.connectors[i];var info={type:connector.getType(),details:_.clone(connector.details),source:connector.sourceItem.details.id,destination:connector.destinationItem.details.id};data.connectors.push(info)}};erd.DiagramArchive.prototype.fromJson=function(json){var data=JSON.parse(json);this.stage.shapes=[];this.stage.connectors=[];if(typeof data.shapes!=="undefined"){this.loadShapes(data.shapes)}if(typeof data.connectors!=="undefined"){this.loadConnectors(data.connectors)}for(var i=0;i<this.stage.shapes.length;++i){this.stage.shapes[i].postLoad()}while(data.version<VERSION){switch(data.version){case 1:this.upgrade1to2(data);break;default:return data}}return data};erd.DiagramArchive.prototype.loadShapes=function(shapes){for(var i=0;i<shapes.length;++i){var shape=this.createShape(shapes[i].type,shapes[i].details);this.stage.addItem(shape)}};erd.DiagramArchive.prototype.createShape=function(type,details){switch(type){case"Entity":return this.stage.factory.entity(details);case"Attribute":return this.stage.factory.attribute(details);case"Relationship":return this.stage.factory.relationship(details);case"Table":return this.stage.factory.table(details);case"Fact":return this.stage.factory.fact(details);case"Dimension":return this.stage.factory.dimension(details);case"Label":return this.stage.factory.label(details);default:throw"erd.DiagramArchive.createShape: unable to create "+type}};erd.DiagramArchive.prototype.loadConnectors=function(connectors){for(var i=0;i<connectors.length;++i){var conn=connectors[i];var source=this.stage.findById(conn.source);var destination=this.stage.findById(conn.destination);this.stage.connect.items(source,destination,conn.details)}};erd.DiagramArchive.prototype.upgrade1to2=function(data){data.version=2;for(var j=0;j<data.shapes.length;++j){switch(data.shapes[j].type){case"Table":case"Fact":case"Dimension":var shapeDetails=data.shapes[j].details;for(var k=0;k<shapeDetails.attributes.length;++k){shapeDetails.attributes[k].dataType="int"}break}}for(var i=0;i<data.connectors.length;++i){if(data.connectors[i].type==="TableConnector"){var conn=this.stage.findById(data.connectors[i].details.id);var newFk=conn.pkTable.createFk();var existingFk=conn.fkTable.getAttributeById(conn.details.fkAttributeId);existingFk.references=newFk.references;if(newFk.names.length>1){if(existingFk!==null){existingFk.names=newFk.names}}}}}})();"use strict";window.erd=window.erd||{};(function(){erd.samples={erd1:'{"version":1,"created":1417301189727,"www":"erdplus.com","shapes":[{"type":"Entity","details":{"name":"entity1","type":"regular","x":726,"y":83,"id":13}},{"type":"Entity","details":{"name":"entity2","type":"weak","x":110,"y":350,"id":14}},{"type":"Entity","details":{"name":"entity3","type":"associative","x":697,"y":354,"id":15}},{"type":"Entity","details":{"name":"entity4","type":"regular","x":130,"y":78,"id":16}},{"type":"Attribute","details":{"name":"attribute1","isDerived":false,"isMultivalued":false,"isOptional":false,"isComposite":false,"isUnique":false,"x":637,"y":158,"id":1}},{"type":"Attribute","details":{"name":"attribute2","isDerived":true,"isMultivalued":false,"isOptional":false,"isComposite":false,"isUnique":false,"x":842,"y":127,"id":2}},{"type":"Attribute","details":{"name":"attribute3","isDerived":false,"isMultivalued":true,"isOptional":false,"isComposite":false,"isUnique":false,"x":808,"y":224,"id":3}},{"type":"Attribute","details":{"name":"attribute4","isDerived":false,"isMultivalued":false,"isOptional":true,"isComposite":false,"isUnique":false,"x":763,"y":169,"id":4}},{"type":"Attribute","details":{"name":"attribute5","isDerived":false,"isMultivalued":false,"isOptional":false,"isComposite":true,"isUnique":false,"x":118,"y":277,"id":5}},{"type":"Attribute","details":{"name":"attribute6","isDerived":false,"isMultivalued":false,"isOptional":false,"isComposite":false,"isUnique":true,"x":687,"y":215,"id":6}},{"type":"Attribute","details":{"name":"attribute7","isDerived":false,"isMultivalued":false,"isOptional":false,"isComposite":false,"isUnique":false,"x":190,"y":226,"id":7}},{"type":"Attribute","details":{"name":"attribute8","isDerived":false,"isMultivalued":false,"isOptional":false,"isComposite":false,"isUnique":false,"x":85,"y":219,"id":8}},{"type":"Attribute","details":{"name":"attribute9","isDerived":false,"isMultivalued":false,"isOptional":false,"isComposite":true,"isUnique":false,"x":396,"y":188,"id":9}},{"type":"Attribute","details":{"name":"attribute10","isDerived":false,"isMultivalued":false,"isOptional":false,"isComposite":false,"isUnique":false,"x":498,"y":166,"id":10}},{"type":"Attribute","details":{"name":"attribute11","isDerived":false,"isMultivalued":false,"isOptional":false,"isComposite":false,"isUnique":false,"x":500,"y":213,"id":11}},{"type":"Attribute","details":{"name":"attribute12","isDerived":false,"isMultivalued":false,"isOptional":false,"isComposite":false,"isUnique":false,"x":407,"y":279,"id":12}},{"type":"Relationship","details":{"x":458,"y":82,"name":"relationship1","isIdentifying":false,"slots":[{"minimum":0,"maximum":1,"participation":"mandatory","cardinality":"many","role":"aaa","entityId":13},{"minimum":0,"maximum":1,"participation":"mandatory","cardinality":"one","role":"bbb","entityId":16}],"id":27}},{"type":"Relationship","details":{"x":429,"y":348,"name":"relationship2","isIdentifying":true,"slots":[{"minimum":0,"maximum":1,"participation":"optional","cardinality":"many","role":"ccc","entityId":14},{"minimum":0,"maximum":1,"participation":"optional","cardinality":"one","role":"ddd","entityId":15}],"id":28}}],"connectors":[{"type":"Connector","details":{"id":17},"source":1,"destination":13},{"type":"Connector","details":{"id":18},"source":2,"destination":13},{"type":"Connector","details":{"id":19},"source":3,"destination":13},{"type":"Connector","details":{"id":20},"source":4,"destination":13},{"type":"Connector","details":{"id":21},"source":6,"destination":13},{"type":"Connector","details":{"id":22},"source":5,"destination":14},{"type":"Connector","details":{"id":23},"source":7,"destination":5},{"type":"Connector","details":{"id":24},"source":8,"destination":5},{"type":"Connector","details":{"id":25},"source":10,"destination":9},{"type":"Connector","details":{"id":26},"source":11,"destination":9},{"type":"Connector","details":{"id":29},"source":12,"destination":28},{"type":"RelationshipConnector","details":{"id":30},"source":13,"destination":27},{"type":"RelationshipConnector","details":{"id":31},"source":16,"destination":27},{"type":"RelationshipConnector","details":{"id":32},"source":14,"destination":28},{"type":"RelationshipConnector","details":{"id":33},"source":15,"destination":28}]}',erd2:'{"version":1,"created":1418097001461,"www":"erdplus.com","shapes":[{"type":"Entity","details":{"name":"Entity","type":"regular","x":107,"y":67,"id":44}},{"type":"Entity","details":{"name":"Entity","type":"regular","x":100,"y":315,"id":45}},{"type":"Entity","details":{"name":"Entity","type":"regular","x":324,"y":101,"id":46}},{"type":"Entity","details":{"name":"Entity","type":"regular","x":464,"y":314,"id":47}},{"type":"Entity","details":{"name":"Entity","type":"regular","x":853,"y":74,"id":48}},{"type":"Entity","details":{"name":"Entity","type":"regular","x":852,"y":272,"id":49}},{"type":"Relationship","details":{"name":"Relationship","isIdentifying":false,"x":1027,"y":155,"slots":[{"participation":"unspecified","cardinality":"unspecified","role":"","entityId":49},{"participation":"unspecified","cardinality":"unspecified","role":"","entityId":0}],"id":50}},{"type":"Relationship","details":{"name":"Relationship","isIdentifying":false,"x":262,"y":197,"slots":[{"participation":"unspecified","cardinality":"unspecified","role":"","entityId":47},{"participation":"unspecified","cardinality":"unspecified","role":"","entityId":46}],"id":51}},{"type":"Relationship","details":{"name":"Relationship","isIdentifying":false,"x":669,"y":317,"slots":[{"participation":"unspecified","cardinality":"unspecified","role":"","entityId":47},{"participation":"unspecified","cardinality":"unspecified","role":"","entityId":0}],"id":52}},{"type":"Relationship","details":{"name":"Relationship","isIdentifying":false,"x":1069,"y":338,"slots":[{"participation":"unspecified","cardinality":"unspecified","role":"","entityId":49},{"participation":"unspecified","cardinality":"unspecified","role":"","entityId":0}],"id":53}},{"type":"Relationship","details":{"name":"Relationship","isIdentifying":false,"x":104,"y":176,"slots":[{"participation":"unspecified","cardinality":"unspecified","role":"","entityId":44},{"participation":"unspecified","cardinality":"unspecified","role":"","entityId":45}],"id":54}},{"type":"Relationship","details":{"name":"Relationship","isIdentifying":false,"x":276,"y":296,"slots":[{"participation":"unspecified","cardinality":"unspecified","role":"","entityId":45},{"participation":"unspecified","cardinality":"unspecified","role":"","entityId":47}],"id":57}},{"type":"Relationship","details":{"name":"Relationship","isIdentifying":false,"x":487,"y":194,"slots":[{"participation":"unspecified","cardinality":"unspecified","role":"","entityId":46},{"participation":"unspecified","cardinality":"unspecified","role":"","entityId":47}],"id":63}},{"type":"Relationship","details":{"name":"Relationship","isIdentifying":false,"x":658,"y":91,"slots":[{"participation":"unspecified","cardinality":"unspecified","role":"","entityId":46},{"participation":"unspecified","cardinality":"unspecified","role":"","entityId":48}],"id":66}}],"connectors":[{"type":"RelationshipConnector","details":{"id":55},"source":44,"destination":54},{"type":"RelationshipConnector","details":{"id":56},"source":45,"destination":54},{"type":"RelationshipConnector","details":{"id":58},"source":45,"destination":57},{"type":"RelationshipConnector","details":{"id":59},"source":47,"destination":57},{"type":"RelationshipConnector","details":{"id":60},"source":47,"destination":52},{"type":"RelationshipConnector","details":{"id":61},"source":47,"destination":51},{"type":"RelationshipConnector","details":{"id":62},"source":46,"destination":51},{"type":"RelationshipConnector","details":{"id":64},"source":46,"destination":63},{"type":"RelationshipConnector","details":{"id":65},"source":47,"destination":63},{"type":"RelationshipConnector","details":{"id":67},"source":46,"destination":66},{"type":"RelationshipConnector","details":{"id":68},"source":48,"destination":66},{"type":"RelationshipConnector","details":{"id":69},"source":49,"destination":50},{"type":"RelationshipConnector","details":{"id":70},"source":49,"destination":53}]}'};erd.samples.createDimension=function(stage){var dimension1=stage.factory.dimension({name:"Region",x:200,y:150,id:1,attributes:[{names:["RegionID"],optional:false,fk:false,pk:true,id:1},{names:["RegionName"],optional:false,fk:false,pk:false,id:2}]});var dimension2=stage.factory.dimension({name:"Store",x:500,y:120,id:2,attributes:[{names:["StoreID"],pk:true,fk:false,optional:false,id:1},{names:["StoreZip"],pk:false,fk:false,optional:false,id:2}]});var fact=stage.factory.fact({name:"Employee",x:800,y:150,id:3,attributes:[{names:["First Name","Last Name"],pk:true,fk:false,optional:false,id:1},{names:["Wage"],pk:false,fk:false,optional:false,id:2}]});stage.addItem(dimension1);stage.addItem(dimension2);stage.addItem(fact)};erd.samples.createRelational=function(stage){var region=stage.factory.table({name:"Region",x:200,y:150,id:1,attributes:[{names:["RegionID"],optional:false,fk:false,pk:true,id:1},{names:["RegionName"],optional:false,fk:false,pk:false,id:2}]});region.details.uniqueGroups=[[1],[1,2],[2,3],[1,3]];var store=stage.factory.table({name:"Store",x:500,y:120,id:2,attributes:[{names:["StoreID"],pk:true,fk:false,optional:false,id:1},{names:["StoreZip"],pk:false,fk:false,optional:false,id:2}]});store.details.uniqueGroups=[[1],[1,2],[2,3],[1,3]];var employee=stage.factory.table({name:"Employee",x:800,y:150,id:3});employee.addAttribute({names:["First Name"],pk:true,fk:false,optional:false});employee.addAttribute({names:["Last Name"],pk:true,fk:false,optional:false});employee.addAttribute({names:["Wage"],pk:false,fk:false,optional:false});employee.details.uniqueGroups=[[1],[1,2],[2,3],[1,3]];stage.addItem(region);stage.addItem(store);stage.addItem(employee);stage.connect.items(employee,store);store.details.attributes[2].pk=true;stage.connect.items(region,store);stage.connect.items(store,region);stage.connect.items(region,region)};erd.samples.create=function(stage){var attribute1=stage.factory.attribute({x:225,y:100,name:"attribute1",isDerived:false,isMultivalued:false,isOptional:false,isComposite:false,isUnique:false});var attribute2=stage.factory.attribute({x:225,y:100,name:"attribute2",isDerived:true,isMultivalued:false,isOptional:false,isComposite:false,isUnique:false});var attribute3=stage.factory.attribute({x:225,y:100,name:"attribute3",isDerived:false,isMultivalued:true,isOptional:false,isComposite:false,isUnique:false});var attribute4=stage.factory.attribute({x:225,y:100,name:"attribute4",isDerived:false,isMultivalued:false,isOptional:true,isComposite:false,isUnique:false});var attribute5=stage.factory.attribute({x:225,y:100,name:"attribute5",isDerived:false,isMultivalued:false,isOptional:false,isComposite:true,isUnique:false});var attribute6=stage.factory.attribute({x:225,y:100,name:"attribute6",isDerived:false,isMultivalued:false,isOptional:false,isComposite:false,isUnique:true});var attribute7=stage.factory.attribute({x:225,y:100,name:"attribute7",isDerived:false,isMultivalued:false,isOptional:false,isComposite:false,isUnique:false});var attribute8=stage.factory.attribute({x:225,y:100,name:"attribute8",isDerived:false,isMultivalued:false,isOptional:false,isComposite:false,isUnique:false});var attribute9=stage.factory.attribute({x:225,y:100,name:"attribute9",isDerived:false,isMultivalued:false,isOptional:false,isComposite:true,isUnique:false});var attribute10=stage.factory.attribute({x:225,y:100,name:"attribute10",isDerived:false,isMultivalued:false,isOptional:false,isComposite:false,isUnique:false});var attribute11=stage.factory.attribute({x:225,y:100,name:"attribute11",isDerived:false,isMultivalued:false,isOptional:false,isComposite:false,isUnique:false});var attribute12=stage.factory.attribute({x:225,y:100,name:"attribute12",isDerived:false,isMultivalued:false,isOptional:false,isComposite:false,isUnique:false});var entity1=stage.factory.entity({x:100,y:100,name:"entity1",type:"regular"});var entity2=stage.factory.entity({x:100,y:100,name:"entity2",type:"weak"});var entity3=stage.factory.entity({x:100,y:100,name:"entity3",type:"associative"});var entity4=stage.factory.entity({x:100,y:100,name:"entity4",type:"regular"});stage.addItem(entity1);stage.addItem(entity2);stage.addItem(entity3);stage.addItem(entity4);stage.addItem(attribute1);stage.addItem(attribute2);stage.addItem(attribute3);stage.addItem(attribute4);stage.addItem(attribute5);stage.addItem(attribute6);stage.addItem(attribute7);stage.addItem(attribute8);stage.addItem(attribute9);stage.addItem(attribute10);stage.addItem(attribute11);stage.addItem(attribute12);stage.connect.items(entity1,attribute1);stage.connect.items(entity1,attribute2);stage.connect.items(entity1,attribute3);stage.connect.items(entity1,attribute4);stage.connect.items(entity1,attribute6);stage.connect.items(entity2,attribute5);stage.connect.items(attribute5,attribute7);stage.connect.items(attribute5,attribute8);stage.connect.items(attribute9,attribute10);stage.connect.items(attribute9,attribute11);var aaa={minimum:0,maximum:1,participation:"mandatory",cardinality:"many",role:"aaa",entityId:entity1.details.id};var bbb={minimum:0,maximum:1,participation:"mandatory",cardinality:"one",role:"bbb",entityId:entity4.details.id};var ccc={minimum:0,maximum:1,participation:"optional",cardinality:"many",role:"ccc",entityId:entity2.details.id};var ddd={minimum:0,maximum:1,participation:"optional",cardinality:"one",role:"ddd",entityId:entity3.details.id};var relationship1=stage.factory.relationship({x:100,y:175,name:"relationship1",isIdentifying:false,slots:[aaa,bbb]});var relationship2=stage.factory.relationship({x:100,y:175,name:"relationship2",isIdentifying:true,slots:[ccc,ddd]});stage.addItem(relationship1);stage.addItem(relationship2);stage.connect.items(relationship2,attribute12);stage.connect.items(entity1,relationship1);stage.connect.items(entity4,relationship1);stage.connect.items(entity2,relationship2);stage.connect.items(entity3,relationship2)};erd.samples.createLabels=function(stage){var label=stage.factory.label({text:"Here is a sample label and the text here is going to require multiple lines to display properly."});stage.addItem(label)}})();"use strict";window.erd=window.erd||{};(function(){var WIDTH=150;var HALF_WIDTH=WIDTH/2;var LINE_HEIGHT=15;var LINE_MARGIN=2;var SUFFIX_MARGIN=10;var BRACKET_SIZE=5;var attributeDefaults={names:["Attribute"],order:0,pkMember:false,optional:false,soloUnique:false,fk:false,dataType:"int",dataTypeSize:null};erd.BaseTable=function(details){erd.Selectable.call(this);this.details={name:"Table",x:0,y:0,sort:"automatic",attributes:[],uniqueGroups:[]};_.assign(this.details,details);this.moved=false;this.anchors=[];this.anchors.push(new erd.TableAnchor(this,0,LINE_HEIGHT,"left",0));this.anchors.push(new erd.TableAnchor(this,WIDTH,LINE_HEIGHT,"right",0));for(var i=0;i<this.details.attributes.length;++i){this.createAnchors(this.details.attributes[i])}this.updateHeight();this.updateAllAnchors()};_.assign(erd.BaseTable.prototype,erd.Selectable.prototype);erd.BaseTable.prototype.hitTest=function(x,y){return this.details.x<x&&this.details.y<y&&this.details.x+WIDTH>x&&this.details.y+this._attributesHeight+LINE_HEIGHT>y};erd.BaseTable.prototype.getCenterPoint=function(){return{x:this.details.x+HALF_WIDTH,y:this.details.y+(this._attributesHeight+LINE_HEIGHT)/2}};erd.BaseTable.prototype.containedBy=function(rect){var x=this.details.x+HALF_WIDTH;var y=this.details.y+(this._attributesHeight+LINE_HEIGHT)/2;return erd.utils.rectContainsPoint(rect,x,y)};erd.BaseTable.prototype.move=function(dx,dy){if(!this.moved){this.moved=true;this.details.x+=dx;this.details.y+=dy;this.updateConnectors()}};erd.BaseTable.prototype.updateConnectors=function(){for(var i=0;i<this.anchors.length;++i){var anchor=this.anchors[i];anchor.updateAllConnectors()}};erd.BaseTable.prototype.addAttribute=function(attribute){_.defaults(attribute,attributeDefaults);var max=_.reduce(this.details.attributes,function(max,attr){return Math.max(max,attr.id)},0);attribute.id=max+1;var orderMax=_.reduce(this.details.attributes,function(max,attr){return Math.max(max,attr.order)},0);attribute.order=orderMax+1;this.details.attributes.push(attribute);this.updateHeight();this.createAnchors(attribute);this.updateAllAnchors();return attribute};erd.BaseTable.prototype.removeAttribute=function(attribute,stage){if(attribute.pkMember){this.removePkConnectors(stage)}if(attribute.fk){var anchors=this.getAnchorsByAttributeId(attribute.id);for(var i=0;i<anchors.length;++i){anchors[i].removeAllConnectorsFromStage(stage)}this.anchors=_.reject(this.anchors,function(a){return a.attributeId===attribute.id})}this.details.attributes=_.reject(this.details.attributes,function(attr){return attr.id===attribute.id});this.updateHeight();this.updateAllAnchors()};erd.BaseTable.prototype.removePkConnectors=function(stage){var anchors=this.getAnchorsByAttributeId(0);for(var i=0;i<anchors.length;++i){anchors[i].removeAllConnectorsFromStage(stage)}};erd.BaseTable.prototype.createAnchors=function(attribute){if(attribute.fk){this.anchors.push(new erd.TableAnchor(this,0,LINE_HEIGHT,"left",attribute.id));this.anchors.push(new erd.TableAnchor(this,WIDTH,LINE_HEIGHT,"right",attribute.id))}};erd.BaseTable.prototype._updateAnchorOffsets=function(attributeId,y){for(var i=0;i<this.anchors.length;++i){if(this.anchors[i].attributeId===attributeId){this.anchors[i].setOffsetY(y)}}};erd.BaseTable.prototype.updateHeight=function(){var countNames=_.reduce(this.details.attributes,function(count,attr){return count+attr.names.length},0);this._attributesHeight=Math.max(countNames*LINE_HEIGHT,LINE_HEIGHT)};erd.BaseTable.prototype.getTableTitle=function(){return this.details.name};erd.BaseTable.prototype.getTableLineWidth=function(){return 1};erd.BaseTable.prototype.draw=function(context){context.save();context.translate(this.details.x+.5,this.details.y+.5);erd.utils.fillText(context,this.getTableTitle(),{x:HALF_WIDTH,y:LINE_HEIGHT,maxWidth:WIDTH,textAlign:"center",textBaseline:"bottom"});context.save();context.beginPath();if(this.getIsSelected()){context.fillStyle=erd.settings.selectedShapeFill}else{context.fillStyle=erd.settings.shapeFill}context.lineWidth=erd.settings.strokeWidth;context.strokeStyle=erd.settings.stroke;context.lineWidth=this.getTableLineWidth();context.rect(0,LINE_HEIGHT,WIDTH,this._attributesHeight);context.fill();context.stroke();context.restore();var y=LINE_HEIGHT;var attributesInOrder=this.getAttributesByOrder();for(var i=0;i<attributesInOrder.length;++i){var attr=attributesInOrder[i];var height=this.drawAttribute(context,attr,y+LINE_HEIGHT/2);y+=height}context.restore();for(var i=0;i<this.anchors.length;++i){this.anchors[i].draw(context)}};erd.BaseTable.prototype.drawAsConnectTarget=function(context,strokeStyle){this.draw(context);context.save();context.beginPath();context.translate(this.details.x,this.details.y);context.rect(0,0,WIDTH,LINE_HEIGHT+this._attributesHeight);context.strokeStyle=strokeStyle;context.lineWidth=erd.settings.connectStrokeWidth*2;context.stroke();context.restore()};erd.BaseTable.prototype.drawAttribute=function(context,attr,y){var h=LINE_HEIGHT*attr.names.length;var maxWidth=0;for(var i=0;i<attr.names.length;++i){var textMetrics=erd.utils.fillText(context,attr.names[i],{x:LINE_MARGIN,y:y+LINE_HEIGHT*i,maxWidth:WIDTH-2*LINE_MARGIN,underline:attr.pkMember,font:attr.pkMember?erd.settings.boldFont:erd.settings.font});maxWidth=Math.max(maxWidth,textMetrics.width)}var bracketX=0;var bracketY=0;if(attr.names.length>1){context.beginPath();var bracketX=maxWidth+SUFFIX_MARGIN;var bracketY=y-LINE_HEIGHT/2+2;context.moveTo(bracketX,bracketY);context.lineTo(bracketX+BRACKET_SIZE,bracketY);context.lineTo(bracketX+BRACKET_SIZE,bracketY+h-4);context.lineTo(bracketX,bracketY+h-4);context.stroke()}else{bracketX=maxWidth+SUFFIX_MARGIN;bracketY=y-LINE_HEIGHT/2}var suffix="";if(attr.optional){suffix+="(O)"}if(attr.fk){suffix+="(FK)"}suffix+=this._getUniqueSuffix(attr);if(suffix.length>0){erd.utils.fillText(context,suffix,{font:erd.settings.smallFont,x:bracketX+SUFFIX_MARGIN,y:bracketY+h/2,maxWidth:WIDTH})}return h};erd.BaseTable.prototype.getAttributesByOrder=function(){var pkAttributes=[];var fkAttributes=[];var regAttributes=[];for(var i=0;i<this.details.attributes.length;++i){var attr=this.details.attributes[i];if(attr.pkMember){pkAttributes.push(attr)}else if(attr.fk){fkAttributes.push(attr)}else{regAttributes.push(attr)}}if(this.details.sort==="automatic"){return this._getAutomaticSortOrder(pkAttributes,regAttributes,fkAttributes)}else{pkAttributes=_.sortBy(pkAttributes,function(attr){return attr.order});var otherAttributes=regAttributes.concat(fkAttributes);otherAttributes=_.sortBy(otherAttributes,function(attr){return attr.order});if(pkAttributes.length===0){return otherAttributes}else if(otherAttributes.length===0){return pkAttributes}else{var attributes=[];while(otherAttributes.length>0&&otherAttributes[0].order<pkAttributes[0].order){attributes=attributes.concat(otherAttributes.splice(0,1))}attributes=attributes.concat(pkAttributes);attributes=attributes.concat(otherAttributes);return attributes}}};erd.BaseTable.prototype._getAutomaticSortOrder=function(pkAttributes,regAttributes,fkAttributes){return pkAttributes.concat(regAttributes).concat(fkAttributes)};erd.BaseTable.prototype._getUniqueSuffix=function(attribute){var suffixes=[];if(attribute.soloUnique&&!attribute.pkMember){suffixes.push("(U)")}for(var i=0;i<this.details.uniqueGroups.length;++i){if(this.details.uniqueGroups[i].indexOf(attribute.id)!==-1){suffixes.push("(Ugroup"+(i+1)+")")}}if(suffixes.length>0){return suffixes.join("")}else{return""}};erd.BaseTable.prototype.getBounds=function(forMouseMove){var bounds={left:this.details.x,top:this.details.y,right:this.details.x+WIDTH+1,bottom:this.details.y+this._attributesHeight+LINE_HEIGHT+1};for(var i=0;i<this.anchors.length;++i){var a=this.anchors[i];if(a.countConnectors()>0){if(a.side==="left"){bounds.left-=a.getAnchorWidth()}else{bounds.right+=a.getAnchorWidth()}}}return bounds};erd.BaseTable.prototype.hasPk=function(){for(var i=0;i<this.details.attributes.length;++i){if(this.details.attributes[i].pkMember){return true}}return false};erd.BaseTable.prototype.getAnchorsByAttributeId=function(attributeId){var anchors=[];for(var i=0;i<this.anchors.length;++i){if(this.anchors[i].attributeId===attributeId){anchors.push(this.anchors[i])}}return anchors};erd.BaseTable.prototype.getAttributeById=function(attributeId){for(var i=0;i<this.details.attributes.length;++i){if(this.details.attributes[i].id===attributeId){return this.details.attributes[i]}}return null};erd.BaseTable.prototype.createFk=function(){var fk=_.cloneDeep(attributeDefaults);fk.names=[];fk.references=[];fk.fk=true;for(var i=0;i<this.details.attributes.length;++i){var attr=this.details.attributes[i];if(attr.pkMember){if(attr.fk){for(var j=0;j<attr.names.length;++j){fk.names.push(attr.names[j]);fk.references.push({tableId:this.details.id,attributeId:attr.id,fkSubIndex:j})}}else{fk.names.push(attr.names[0]);fk.references.push({tableId:this.details.id,attributeId:attr.id})}}}return fk};erd.BaseTable.prototype.removeFromStage=function(stage){while(this.details.attributes.length>0){this.removeAttribute(this.details.attributes[0],stage)}for(var i=0;i<this.anchors[i];++i){this.anchors[i].removeAllConnectorsFromStage(stage)}stage.removeItem(this)};erd.BaseTable.prototype.postLoad=function(){this.updateAllAnchors()};erd.BaseTable.prototype.updateAllAnchors=function(){var y=LINE_HEIGHT;var attributesInOrder=this.getAttributesByOrder();var totalPkHeight=0;var endPkY=y;for(var i=0;i<attributesInOrder.length;++i){var attr=attributesInOrder[i];var height=LINE_HEIGHT*attr.names.length;y+=height;if(attr.fk){this._updateAnchorOffsets(attr.id,y-height/2)}if(attr.pkMember){totalPkHeight+=height;endPkY=y}}this._updateAnchorOffsets(0,endPkY-totalPkHeight/2)}})();"use strict";window.erd=window.erd||{};(function(){erd.Table=function(details){erd.BaseTable.call(this,details)};_.assign(erd.Table.prototype,erd.BaseTable.prototype);erd.Table.prototype.getType=function(){return"Table"}})();"use strict";window.erd=window.erd||{};(function(){erd.Fact=function(details){erd.BaseTable.call(this,details)};_.assign(erd.Fact.prototype,erd.BaseTable.prototype);erd.Fact.prototype.getType=function(){return"Fact"};erd.Fact.prototype.getTableTitle=function(){return this.details.name+" fact table"};erd.Fact.prototype.getTableLineWidth=function(){return 2};erd.Fact.prototype.getBounds=function(forMouseMove){var bounds=erd.BaseTable.prototype.getBounds.call(this,forMouseMove);bounds.left-=1;bounds.bottom+=1;bounds.right+=1;return bounds};erd.Fact.prototype._getAutomaticSortOrder=function(pkAttributes,regAttributes,fkAttributes){return fkAttributes.concat(pkAttributes).concat(regAttributes)}})();"use strict";window.erd=window.erd||{};(function(){erd.Dimension=function(details){erd.BaseTable.call(this,details)};_.assign(erd.Dimension.prototype,erd.BaseTable.prototype);erd.Dimension.prototype.getType=function(){return"Dimension"};erd.Dimension.prototype._getAutomaticSortOrder=function(pkAttributes,regAttributes,fkAttributes){return fkAttributes.concat(pkAttributes).concat(regAttributes)}})();"use strict";window.erd=window.erd||{};(function(){erd.BaseMouseHandler=function(stage){this.stage=stage};erd.BaseMouseHandler.prototype.onMouseMove=function(evt,x,y){};erd.BaseMouseHandler.prototype.onMouseDown=function(evt,x,y){};erd.BaseMouseHandler.prototype.onMouseUp=function(evt,x,y){};erd.BaseMouseHandler.prototype.drawSpecial=function(context){}})();"use strict";window.erd=window.erd||{};(function(){erd.SelectMouseHandler=function(stage){erd.BaseMouseHandler.call(this,stage);this.mouseInteraction=null};_.assign(erd.SelectMouseHandler.prototype,erd.BaseMouseHandler.prototype);erd.SelectMouseHandler.prototype.onMouseMove=function(evt,x,y){if(this.mouseInteraction!==null){if(this.mouseInteraction.hasItem){x=Math.max(x,this.mouseInteraction.bounds.left);x=Math.min(x,this.mouseInteraction.bounds.right);y=Math.max(y,this.mouseInteraction.bounds.top);y=Math.min(y,this.mouseInteraction.bounds.bottom);var dx=x-this.mouseInteraction.lastMouseX;var dy=y-this.mouseInteraction.lastMouseY;this.mouseInteraction.lastMouseX=x;this.mouseInteraction.lastMouseY=y;if(!this.mouseInteraction.isMovingShape){this.stage.invokeStartMoveCallback();this.mouseInteraction.isMovingShape=true}if(this.mouseInteraction.labelResize){this.mouseInteraction.item.resizeLabel(dx,dy)}else{this.stage.moveSelectedShapes(dx,dy)}}else if(this.mouseInteraction.multiSelectPoints!==null){this.mouseInteraction.multiSelectPoints.x2=x;this.mouseInteraction.multiSelectPoints.y2=y}else{this.mouseInteraction.multiSelectPoints={x1:this.mouseInteraction.lastMouseX,y1:this.mouseInteraction.lastMouseY,x2:x,y2:y}}this.stage.draw()}};erd.SelectMouseHandler.prototype.onMouseDown=function(evt,x,y){var item=this.stage.hitTest(x,y);this.stage.invokeActiveItemChangedCallback(item);var labelResize=false;if(item!==null){if(item.getType()==="Label"&&item.hitTestResize(x,y)){this.stage.clearSelection();item.toggleSelected();labelResize=true}else if(evt.ctrlKey){item.toggleSelected()}else if(!item.getIsSelected()){this.stage.clearSelection();item.setIsSelected(true)}}else{this.stage.clearSelection()}this.mouseInteraction={lastMouseX:x,lastMouseY:y,hasItem:item!==null,item:item,multiSelectPoints:null,isMovingShape:false,labelResize:labelResize};var bounds=this.stage.getBounds(true);this.mouseInteraction.bounds={left:x-bounds.left,top:y-bounds.top,right:x+this.stage.canvas.width-bounds.right,bottom:y+this.stage.canvas.height-bounds.bottom};this.stage.draw()};erd.SelectMouseHandler.prototype.onMouseUp=function(evt,x,y){if(this.mouseInteraction!==null){if(this.mouseInteraction.multiSelectPoints!==null){var rect=normalizeRect(this.mouseInteraction.multiSelectPoints);if(!evt.ctrlKey){this.stage.clearSelection()}this.stage.selectByRect(rect)}if(this.mouseInteraction.isMovingShape){this.stage.invokeEndMoveCallback()}this.mouseInteraction=null;this.stage.draw()}};erd.SelectMouseHandler.prototype.drawSpecial=function(context){if(this.mouseInteraction!==null&&this.mouseInteraction.multiSelectPoints!==null){context.beginPath();context.lineWidth=erd.settings.strokeWidth;context.strokeStyle=erd.settings.stroke;context.fillStyle=erd.settings.selectRectFill;var rect=normalizeRect(this.mouseInteraction.multiSelectPoints);context.rect(rect.x,rect.y,rect.w,rect.h);context.fill();context.stroke()}};var normalizeRect=function(multiSelectPoints){var rect={};rect.x=Math.min(multiSelectPoints.x1,multiSelectPoints.x2);rect.y=Math.min(multiSelectPoints.y1,multiSelectPoints.y2);rect.w=Math.abs(multiSelectPoints.x1-multiSelectPoints.x2);rect.h=Math.abs(multiSelectPoints.y1-multiSelectPoints.y2);return rect}})();"use strict";window.erd=window.erd||{};(function(){erd.EntityMouseHandler=function(stage){erd.BaseMouseHandler.call(this,stage)};_.assign(erd.EntityMouseHandler.prototype,erd.BaseMouseHandler.prototype);erd.EntityMouseHandler.prototype.onMouseDown=function(evt,x,y){var entity=this.stage.factory.entity({x:x,y:y});this.stage.handleMouseDropItem(entity)}})();"use strict";window.erd=window.erd||{};(function(){erd.AttributeMouseHandler=function(stage){erd.BaseMouseHandler.call(this,stage)};_.assign(erd.AttributeMouseHandler.prototype,erd.BaseMouseHandler.prototype);erd.AttributeMouseHandler.prototype.onMouseDown=function(evt,x,y){var attribute=this.stage.factory.attribute({x:x,y:y});this.stage.handleMouseDropItem(attribute)}})();"use strict";window.erd=window.erd||{};(function(){erd.RelationshipMouseHandler=function(stage){erd.BaseMouseHandler.call(this,stage)};_.assign(erd.RelationshipMouseHandler.prototype,erd.BaseMouseHandler.prototype);erd.RelationshipMouseHandler.prototype.onMouseDown=function(evt,x,y){var relationship=this.stage.factory.relationship({x:x,y:y});this.stage.handleMouseDropItem(relationship)}})();"use strict";window.erd=window.erd||{};(function(){erd.TableMouseHandler=function(stage){erd.BaseMouseHandler.call(this,stage)};_.assign(erd.TableMouseHandler.prototype,erd.BaseMouseHandler.prototype);erd.TableMouseHandler.prototype.onMouseDown=function(evt,x,y){var table=this.stage.factory.table({x:x,y:y});this.stage.handleMouseDropItem(table)}})();"use strict";window.erd=window.erd||{};(function(){erd.ConnectMouseHandler=function(stage){erd.BaseMouseHandler.call(this,stage);this.startShape=null;this.endShape=null;this.trackingPoint=null};_.assign(erd.ConnectMouseHandler.prototype,erd.BaseMouseHandler.prototype);erd.ConnectMouseHandler.prototype.onMouseMove=function(evt,x,y){if(this.startShape!==null){var shape=this.stage.hitTest(x,y);if(shape!==null&&shape.details.id!==this.startShape.details.id){this.endShape=shape;this.trackingPoint=null}else{this.endShape=null;this.trackingPoint={x:x,y:y}}this.stage.draw()}};erd.ConnectMouseHandler.prototype.onMouseDown=function(evt,x,y){var shape=this.stage.hitTest(x,y);if(shape!==null){this.startShape=shape;this.stage.draw()}};erd.ConnectMouseHandler.prototype.onMouseUp=function(evt,x,y){this.connect();this.startShape=null;this.endShape=null;this.trackingPoint=null;this.stage.draw();this.stage.invokeConnectModeEndCallback()};erd.ConnectMouseHandler.prototype.drawSpecial=function(context){if(this.startShape!==null&&(this.trackingPoint!==null||this.endShape!==null)){var pt1=this.startShape.getCenterPoint();var pt2=this.trackingPoint;if(this.endShape!==null){pt2=this.endShape.getCenterPoint()}var color=erd.settings.connectMissStroke;if(this.canConnect()){color=erd.settings.connectHitStroke}context.save();context.strokeStyle=color;context.lineWidth=erd.settings.connectStrokeWidth;context.beginPath();context.moveTo(pt1.x,pt1.y);context.lineTo(pt2.x,pt2.y);context.stroke();context.restore();this.startShape.drawAsConnectTarget(context,color);if(this.endShape!==null){this.endShape.drawAsConnectTarget(context,color)}}};erd.ConnectMouseHandler.prototype.canConnect=function(){if(this.startShape!==null&&this.endShape!==null){var startType=this.startShape.getType();var endType=this.endShape.getType();if(!this.limitSingleConnector(startType,endType)){return false}if(this.startShape.getType()==="Relationship"&&this.endShape.getType()==="Relationship"){return false}if(this.startShape.getType()==="Relationship"&&this.endShape.getType()==="Entity"&&this.startShape.relatedEntityCount()===2){return false}if(this.endShape.getType()==="Relationship"&&this.startShape.getType()==="Entity"&&this.endShape.relatedEntityCount()===2){return false}if(this.startShape.getType()==="Attribute"&&this.endShape.getType()==="Attribute"){if(this.startShape.details.isComposite===false&&this.endShape.details.isComposite===false){return false}}if(this.startShape.getType()==="Table"&&this.endShape.getType()==="Table"){return this.startShape.hasPk()||this.endShape.hasPk()}if(this.startShape.getType()==="Dimension"&&(this.endShape.getType()==="Fact"||this.endShape.getType()==="Dimension")){return this.startShape.hasPk()}if(this.startShape.getType()==="Fact"){return false}return true}else{return false}};erd.ConnectMouseHandler.prototype.limitSingleConnector=function(startType,endType){var pairs=[["Attribute","Attribute"],["Attribute","Entity"],["Attribute","Relationship"]];for(var i=0;i<pairs.length;++i){if(pairs[i][0]===startType&&pairs[i][1]===endType||pairs[i][1]===startType&&pairs[i][0]===endType){var id1=this.startShape.details.id;var id2=this.endShape.details.id;var connector=this.stage.findConnectorByIds(id1,id2);if(connector!==null){return false}}}return true};erd.ConnectMouseHandler.prototype.connect=function(){if(this.canConnect()){this.stage.undoManager.startAction();if(this.startShape.getType()==="Entity"&&this.endShape.getType()==="Entity"){var entity1=this.startShape;var entity2=this.endShape;var pt={x:Math.round((entity1.details.x+entity2.details.x)/2),y:Math.round((entity1.details.y+entity2.details.y)/2)};var relationship=this.stage.factory.relationship(pt);this.stage.addItem(relationship);this.stage.connect.items(entity1,relationship);this.stage.connect.items(entity2,relationship);this.stage.clearSelection();relationship.setIsSelected(true);this.stage.invokeActiveItemChangedCallback(relationship)}else{this.stage.connect.items(this.startShape,this.endShape)}this.stage.undoManager.endAction();this.stage.resetMouseMode()}}})();"use strict";window.erd=window.erd||{};(function(){erd.FactMouseHandler=function(stage){erd.BaseMouseHandler.call(this,stage)};_.assign(erd.FactMouseHandler.prototype,erd.BaseMouseHandler.prototype);erd.FactMouseHandler.prototype.onMouseDown=function(evt,x,y){var fact=this.stage.factory.fact({x:x,y:y,name:"Fact"});this.stage.handleMouseDropItem(fact)}})();"use strict";window.erd=window.erd||{};(function(){erd.DimensionMouseHandler=function(stage){erd.BaseMouseHandler.call(this,stage)};_.assign(erd.DimensionMouseHandler.prototype,erd.BaseMouseHandler.prototype);erd.DimensionMouseHandler.prototype.onMouseDown=function(evt,x,y){var dimension=this.stage.factory.dimension({x:x,y:y,name:"Dimension"});this.stage.handleMouseDropItem(dimension)}})();"use strict";window.erd=window.erd||{};(function(){erd.LabelMouseHandler=function(stage){erd.BaseMouseHandler.call(this,stage)};_.assign(erd.LabelMouseHandler.prototype,erd.BaseMouseHandler.prototype);erd.LabelMouseHandler.prototype.onMouseDown=function(evt,x,y){var label=this.stage.factory.label({x:x-50,y:y-25});this.stage.handleMouseDropItem(label)}})();"use strict";window.erd=window.erd||{};(function(){erd.NoneMouseHandler=function(stage){erd.BaseMouseHandler.call(this,stage)};_.assign(erd.NoneMouseHandler.prototype,erd.BaseMouseHandler.prototype)})();"use strict";window.erd=window.erd||{};(function(){erd.UndoManager=function(stage){this.undoStack=[];this.redoStack=[];this.stage=stage;this.archiver=new erd.DiagramArchive(this.stage);this.currentAction=null};erd.UndoManager.prototype.clear=function(){this.undoStack=[];this.redoStack=[]};erd.UndoManager.prototype.hasCurrentAction=function(){return this.currentAction!==null};erd.UndoManager.prototype.startAction=function(){this.stage.invokeDirtyCallback();if(this.currentAction===null){this.currentAction={undoContent:this.archiver.toJson(),redoContent:null}}};erd.UndoManager.prototype.endAction=function(){if(this.currentAction!==null){this.undoStack.push(this.currentAction);this.currentAction=null;this.redoStack=[]}this.stage.invokeDirtyCallback()};erd.UndoManager.prototype.canUndo=function(){return this.undoStack.length>0};erd.UndoManager.prototype.canRedo=function(){return this.redoStack.length>0};erd.UndoManager.prototype.undo=function(){if(this.canUndo()){var action=this.undoStack.pop();if(action.redoContent===null){action.redoContent=this.archiver.toJson()}this.archiver.fromJson(action.undoContent);this.stage.draw();this.redoStack.push(action);this.stage.invokeDirtyCallback()}};erd.UndoManager.prototype.redo=function(){if(this.canRedo()){var action=this.redoStack.pop();this.archiver.fromJson(action.redoContent);this.stage.draw();this.undoStack.push(action);this.stage.invokeDirtyCallback()}}})();"use strict";window.erd=window.erd||{};(function(){var WIDTH=20;erd.TableAnchor=function(owner,dx,dy,side,attributeId){erd.Anchor.call(this,owner,dx,dy);this.side=side;this.attributeId=attributeId};_.assign(erd.TableAnchor.prototype,erd.Anchor.prototype);erd.TableAnchor.prototype.getPoint=function(){if(this.side==="left"){return{x:this.owner.details.x+this.dx-WIDTH,y:this.owner.details.y+this.dy}}else{return{x:this.owner.details.x+this.dx+WIDTH,y:this.owner.details.y+this.dy}}};erd.TableAnchor.prototype.getAnchorWidth=function(){return WIDTH};erd.TableAnchor.prototype.draw=function(context){if(this.firstConnector()!==null){var pt=this.getPoint();context.save();context.translate(pt.x,pt.y);if(this.side==="right"){context.rotate(Math.PI)}context.strokeStyle=erd.settings.stroke;context.beginPath();context.moveTo(0,0);context.lineTo(WIDTH,0);context.stroke();if(this.isPkAnchor()){context.beginPath();context.fillStyle=erd.settings.arrowFill;context.moveTo(WIDTH,0);context.lineTo(WIDTH-5,0-5);context.lineTo(WIDTH-5,0+5);context.closePath();context.stroke();context.fill()}context.restore()}};erd.TableAnchor.prototype.isPkAnchor=function(){return this.attributeId===0}})();"use strict";window.erd=window.erd||{};(function(){erd.TableConnector=function(pkTable,fkTable,details){erd.Connector.call(this,pkTable,fkTable,details);this.pkTable=pkTable;this.fkTable=fkTable};_.assign(erd.TableConnector.prototype,erd.Connector.prototype);erd.TableConnector.prototype.getType=function(){return"TableConnector"};erd.TableConnector.prototype.updateAnchors=function(){if(this.sourceAnchor!==null){this.sourceAnchor.removeConnector(this);this.sourceAnchor=null}if(this.destinationAnchor!==null){this.destinationAnchor.removeConnector(this);this.destinationAnchor=null}var pkAnchors=this.pkTable.getAnchorsByAttributeId(0);var fkAnchors=this.fkTable.getAnchorsByAttributeId(this.details.fkAttributeId);var foundDistance=Number.MAX_VALUE;for(var i=0;i<pkAnchors.length;++i){var a=pkAnchors[i];for(var j=0;j<fkAnchors.length;++j){var b=fkAnchors[j];var distance=erd.utils.distance(a.getPoint(),b.getPoint());if(distance<foundDistance){this.sourceAnchor=a;this.destinationAnchor=b;foundDistance=distance}}}this.sourceAnchor.addConnector(this);this.destinationAnchor.addConnector(this)};erd.TableConnector.prototype.removeFromStage=function(stage){erd.Connector.prototype.removeFromStage.call(this,stage);var attr=this.fkTable.getAttributeById(this.details.fkAttributeId);if(attr!==null){this.fkTable.removeAttribute(attr,stage)}}})();"use strict";window.erd=window.erd||{};(function(){var HANDLE_OFFSET=20;var MIN_WIDTH=50;var MIN_HEIGHT=50;erd.Label=function(details){erd.Selectable.call(this);this.details={text:"New Label",x:0,y:0,width:100,height:50};_.assign(this.details,details);this.moved=false};_.assign(erd.Label.prototype,erd.Selectable.prototype);erd.Label.prototype.getType=function(){return"Label"};erd.Label.prototype.hitTest=function(x,y){return this.details.x<x&&this.details.y<y&&this.details.x+this.details.width>x&&this.details.y+this.details.height>y};erd.Label.prototype.hitTestResize=function(x,y){return this.details.x+this.details.width-HANDLE_OFFSET<x&&this.details.y+this.details.height-HANDLE_OFFSET<y&&this.details.x+this.details.width>x&&this.details.y+this.details.height>y};erd.Label.prototype.containedBy=function(rect){var x=this.details.x+this.details.width/2;var y=this.details.y+this.details.height/2;return erd.utils.rectContainsPoint(rect,x,y)};erd.Label.prototype.move=function(dx,dy){if(!this.moved){this.moved=true;this.details.x+=dx;this.details.y+=dy}};erd.Label.prototype.resizeLabel=function(dx,dy){this.details.width=Math.max(this.details.width+dx,MIN_WIDTH);this.details.height=Math.max(this.details.height+dy,MIN_HEIGHT)};erd.Label.prototype.draw=function(context){context.save();context.translate(this.details.x+.5,this.details.y+.5);context.beginPath();if(this.getIsSelected()){context.fillStyle=erd.settings.selectedShapeFill}else{context.fillStyle=erd.settings.shapeFill}context.lineWidth=erd.settings.strokeWidth;context.strokeStyle=erd.settings.stroke;context.lineWidth=erd.settings.lineWidth;context.rect(0,0,this.details.width,this.details.height);context.fill();if(this.getIsSelected()){context.stroke();context.beginPath();var x=this.details.width;var y=this.details.height;context.fillStyle=erd.settings.labelResizeShapeFill;context.moveTo(x-HANDLE_OFFSET,y);context.lineTo(x,y-HANDLE_OFFSET);context.lineTo(x,y);context.fill();context.stroke()}erd.utils.wrapText(context,this.details.text,{x:2,textAlign:"left",textBaseline:"top",width:this.details.width-4,height:this.details.height});context.restore()};erd.Label.prototype.drawAsConnectTarget=function(context,strokeStyle){};erd.Label.prototype.getBounds=function(forMouseMove){var bounds={left:this.details.x,top:this.details.y,right:this.details.x+this.details.width+1,bottom:this.details.y+this.details.height+1};return bounds};erd.Label.prototype.removeFromStage=function(stage){stage.removeItem(this)}})();